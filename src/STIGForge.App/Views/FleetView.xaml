<UserControl x:Class="STIGForge.App.Views.FleetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TabControl Grid.Row="0">

      <!-- Operations Tab -->
      <TabItem Header="Operations">
        <StackPanel Margin="12">
          <TextBlock Text="Fleet Operations (WinRM)" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Targets:" Width="80" VerticalAlignment="Center"/>
            <TextBox Width="620" Text="{Binding FleetTargets}"
                     AutomationProperties.Name="Fleet targets"
                         ToolTipService.ToolTip="Type computer names separated by commas (e.g., server1,server2). You can also add IP addresses with a colon (e.g., server1:10.0.0.5). Or just use the Inventory tab."/>
          </WrapPanel>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Operation:" Width="80" VerticalAlignment="Center"/>
            <ComboBox Width="140" ItemsSource="{Binding FleetOperations}" SelectedItem="{Binding FleetOperation}"
                      AutomationProperties.Name="Fleet operation"
                      ToolTipService.ToolTip="What to do on the remote machines: Apply (fix settings), Verify (scan and check), or Orchestrate (do everything in sequence)."/>
            <TextBlock Text="Concurrency:" Width="90" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="60" Text="{Binding FleetConcurrency}"
                     AutomationProperties.Name="Fleet concurrency"
                      ToolTipService.ToolTip="How many machines to work on at the same time. Higher = faster but uses more resources."/>
            <TextBlock Text="Timeout:" Width="70" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="60" Text="{Binding FleetTimeout}"
                     AutomationProperties.Name="Fleet timeout seconds"
                      ToolTipService.ToolTip="How long to wait (in seconds) for each machine before giving up. Increase for slow networks."/>
          </WrapPanel>

          <!-- Remote Settings -->
          <Separator Margin="0,4,0,8"/>
          <TextBlock Text="Remote Compliance Settings" FontWeight="SemiBold" Margin="0,0,0,6"/>
          <TextBlock Text="Fleet uses the selected bundle below (not individual pack selection). Build the bundle first, then target hosts with that bundle."
                     Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,6" TextWrapping="Wrap"/>
          <WrapPanel Margin="0,0,0,6">
            <TextBlock Text="Bundle:" Width="80" VerticalAlignment="Center"/>
            <TextBox Width="520" Text="{Binding BundleRoot}" AutomationProperties.Name="Fleet bundle root"
                     ToolTipService.ToolTip="Bundle folder to use for remote operations. Same bundle from the Build tab."/>
            <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                    Command="{Binding BrowseBundleCommand}" AutomationProperties.Name="Browse for bundle"/>
          </WrapPanel>
          <WrapPanel Margin="0,0,0,6">
            <TextBlock Text="Eval-STIG:" Width="80" VerticalAlignment="Center"/>
            <TextBox Width="520" Text="{Binding EvaluateStigRoot}" AutomationProperties.Name="Fleet Evaluate-STIG root"
                     ToolTipService.ToolTip="Folder containing the Evaluate-STIG scanner. Used for remote verify operations."/>
            <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                    Command="{Binding BrowseEvaluateStigCommand}" AutomationProperties.Name="Browse for Evaluate-STIG"/>
          </WrapPanel>

          <Separator Margin="0,8,0,8"/>
          <WrapPanel>
            <Button Content="Execute" MinWidth="120" Height="34" Padding="14,0" FontWeight="SemiBold" Margin="0,0,10,0"
                    Command="{Binding FleetExecuteCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Execute fleet operation"
                    ToolTipService.ToolTip="Run the selected operation across all target machines via WinRM."/>
            <Button Content="Check Status" MinWidth="130" Height="34" Padding="14,0" Margin="0,0,10,0"
                    Command="{Binding FleetCheckStatusCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Check fleet status"
                    ToolTipService.ToolTip="Test WinRM connectivity to all target machines."/>
            <TextBlock Text="{Binding FleetStatus}" Margin="0,10,0,0" Foreground="{DynamicResource TextMutedBrush}"/>
          </WrapPanel>
        </StackPanel>
      </TabItem>

      <!-- Inventory Tab -->
      <TabItem Header="Inventory">
        <StackPanel Margin="12">
          <TextBlock Text="Fleet Inventory" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <TextBlock Text="Saved targets persist across sessions. Use comma-separated hostnames above or manage the inventory below."
                     Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
           <ListView ItemsSource="{Binding FleetInventoryItems}" SelectedItem="{Binding SelectedFleetInventoryItem}" MaxHeight="200" MinHeight="80"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     ScrollViewer.CanContentScroll="True">
             <ListView.View>
               <GridView>
                 <GridViewColumn Header="Hostname" DisplayMemberBinding="{Binding HostName}" Width="200"/>
                 <GridViewColumn Header="IP" DisplayMemberBinding="{Binding IpAddress}" Width="140"/>
                 <GridViewColumn Header="WinRM" DisplayMemberBinding="{Binding WinRmStatus}" Width="80"/>
                 <GridViewColumn Header="Last Check" DisplayMemberBinding="{Binding LastCheckLabel}" Width="120"/>
               </GridView>
             </ListView.View>
           </ListView>
          <WrapPanel Margin="0,8,0,0">
            <Button Content="Add Host" MinWidth="100" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding AddFleetHostCommand}"
                    AutomationProperties.Name="Add fleet host"
                    ToolTipService.ToolTip="Parse the Targets field above and add hosts to the inventory."/>
            <Button Content="Remove Selected" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding RemoveFleetHostCommand}"
                    AutomationProperties.Name="Remove selected fleet host"
                    ToolTipService.ToolTip="Remove the highlighted host from the fleet inventory."/>
            <Button Content="Ping All" MinWidth="90" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding PingAllFleetCommand}"
                    AutomationProperties.Name="Ping all fleet hosts"
                    ToolTipService.ToolTip="Send ICMP ping to all hosts in the fleet inventory."/>
            <Button Content="Test WinRM All" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding TestWinRmAllFleetCommand}"
                    AutomationProperties.Name="Test WinRM for all fleet hosts"
                    ToolTipService.ToolTip="Test WinRM connectivity to all hosts in the fleet inventory."/>
            <Button Content="Import CSV" MinWidth="110" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding ImportFleetCsvCommand}"
                    AutomationProperties.Name="Import fleet hosts from CSV"
                    ToolTipService.ToolTip="Import fleet hosts from a CSV file with hostname and ip columns."/>
            <Button Content="Discover from AD" MinWidth="140" Height="30" Padding="14,0" Margin="0,0,0,4"
                    Command="{Binding DiscoverAdHostsCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Discover hosts from Active Directory"
                    ToolTipService.ToolTip="Search your Active Directory domain for computers and automatically add them to the fleet list."/>
          </WrapPanel>
        </StackPanel>
      </TabItem>

      <!-- Schedule Tab -->
      <TabItem Header="Schedule">
        <StackPanel Margin="12">
          <TextBlock Text="Scheduled Re-Verification" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Task Name:" Width="90" VerticalAlignment="Center"/>
            <TextBox Width="240" Text="{Binding SchedTaskName}" AutomationProperties.Name="Scheduled task name"
                     ToolTipService.ToolTip="Name for the Windows scheduled task. Shows up in Task Scheduler."/>
            <TextBlock Text="Frequency:" Width="80" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <ComboBox Width="120" ItemsSource="{Binding ScheduleFrequencies}" SelectedItem="{Binding SchedFrequency}"
                      AutomationProperties.Name="Schedule frequency"
                      ToolTipService.ToolTip="How often to run the re-verification: daily, weekly, or monthly."/>
            <TextBlock Text="Time:" Width="50" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="80" Text="{Binding SchedTime}" AutomationProperties.Name="Schedule time"
                     ToolTipService.ToolTip="Time of day to run the task (e.g., 02:00 for 2 AM)."/>
          </WrapPanel>
          <WrapPanel Margin="0,0,0,8">
            <Button Content="Register Task" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding ScheduleRegisterCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Register scheduled task"
                    ToolTipService.ToolTip="Create a Windows scheduled task for recurring re-verification."/>
            <Button Content="Remove Task" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding ScheduleRemoveCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Remove scheduled task"
                    ToolTipService.ToolTip="Delete the scheduled task from Windows Task Scheduler."/>
            <Button Content="Refresh" MinWidth="90" Height="30" Padding="14,0" Margin="0,0,0,4"
                    Command="{Binding ScheduleRefreshCommand}"
                    AutomationProperties.Name="Refresh schedule list"/>
          </WrapPanel>
          <TextBlock Text="{Binding SchedStatus}" Foreground="{DynamicResource TextMutedBrush}"/>
          <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Margin="0,6,0,0" Background="{DynamicResource SurfaceMutedBrush}">
            <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="120">
              <TextBlock Text="{Binding SchedListOutput}" FontFamily="Consolas" FontSize="11" Padding="6" TextWrapping="Wrap"/>
            </ScrollViewer>
          </Border>
        </StackPanel>
      </TabItem>

    </TabControl>

    <!-- Fleet Log -->
    <TextBlock Grid.Row="1" Text="Fleet Log" FontSize="14" FontWeight="SemiBold" Margin="0,8,0,4"/>
    <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Background="{DynamicResource SurfaceBrush}">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <TextBlock Text="{Binding FleetLog}" FontFamily="Consolas" FontSize="11" Padding="8" TextWrapping="Wrap"
                   AutomationProperties.Name="Fleet operation log"/>
      </ScrollViewer>
    </Border>
  </Grid>
  </ScrollViewer>
</UserControl>
