<UserControl x:Class="STIGForge.App.Views.OrchestrateView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="200"/>
    </Grid.RowDefinitions>

    <!-- Settings Panel -->
    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
      <StackPanel>

        <TextBlock Text="Orchestrate Pipeline" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,4"/>
        <TextBlock Text="Run the full Apply, Verify, and Export pipeline. Configure mission preset, scanner tools, PowerSTIG, and safety options below."
                   Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,0,0,12"/>

        <!-- Mission Preset -->
        <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,8" Background="{DynamicResource SurfaceMutedBrush}">
          <StackPanel>
            <WrapPanel Margin="0,0,0,8">
              <TextBlock Text="Mission preset:" Width="130" VerticalAlignment="Center"/>
              <ComboBox Width="300" ItemsSource="{Binding MissionPresets}" SelectedItem="{Binding SelectedMissionPreset}"
                        AutomationProperties.Name="Mission preset"
                         ToolTipService.ToolTip="Pick a workflow template: regular workstation hardening, building a reference VM image, or preparing a network boot image for deployment."/>
            </WrapPanel>
            <TextBlock Text="{Binding MissionPresetGuidance}" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
          </StackPanel>
        </Border>

        <!-- Bundle + Phases -->
        <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,8" Background="{DynamicResource SurfaceBrush}">
          <StackPanel>
            <WrapPanel Margin="0,0,0,8">
              <TextBlock Text="Bundle:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding BundleRoot}"
                       AutomationProperties.Name="Bundle root path"
                       ToolTipService.ToolTip="Path to the bundle root folder containing manifest.json."/>
              <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding BrowseBundleCommand}"
                      AutomationProperties.Name="Browse for bundle"
                      ToolTipService.ToolTip="Open a folder picker to find your bundle folder."/>
              <Button Content="Open" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding OpenBundleFolderCommand}"
                      AutomationProperties.Name="Open bundle folder"
                      ToolTipService.ToolTip="Open the bundle folder in Windows Explorer."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,8">
              <CheckBox Content="Run Apply" IsChecked="{Binding OrchRunApply}" Margin="0,0,16,0"
                        AutomationProperties.Name="Run apply phase"
                         ToolTipService.ToolTip="Apply security fixes to this computer. Takes a safety snapshot first, then runs the hardening scripts from your bundle."/>
              <CheckBox Content="Run Verify" IsChecked="{Binding OrchRunVerify}" Margin="0,0,16,0"
                        AutomationProperties.Name="Run verify phase"
                         ToolTipService.ToolTip="Run scanners after applying fixes to check whether the hardening changes actually stuck."/>
              <CheckBox Content="Export eMASS" IsChecked="{Binding OrchRunExport}"
                        AutomationProperties.Name="Export eMASS package"
                         ToolTipService.ToolTip="Generate a report package for the eMASS compliance tracking system after apply and verify finish."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,8">
              <CheckBox Content="Skip snapshot (high risk)" IsChecked="{Binding ApplySkipSnapshot}" Margin="0,0,16,0"
                        AutomationProperties.Name="Skip snapshot"
                         ToolTipService.ToolTip="Skip the safety backup before applying changes. Only use this if you have another way to undo (like a VM checkpoint). High risk."/>
              <CheckBox Content="Break-glass acknowledged" IsChecked="{Binding BreakGlassAcknowledged}"
                        AutomationProperties.Name="Break-glass acknowledged"
                        ToolTipService.ToolTip="Required when skip snapshot is enabled."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,8">
              <TextBlock Text="Break-glass reason:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="620" Text="{Binding BreakGlassReason}" IsEnabled="{Binding BreakGlassAcknowledged}"
                       AutomationProperties.Name="Break-glass reason"
                       ToolTipService.ToolTip="Operator justification recorded in audit trail for high-risk bypasses."/>
            </WrapPanel>
          </StackPanel>
        </Border>

        <!-- PowerSTIG Settings -->
        <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,8" Background="{DynamicResource SurfaceBrush}">
          <StackPanel>
            <TextBlock Text="PowerSTIG (Optional)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Module:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding PowerStigModulePath}"
                       AutomationProperties.Name="PowerSTIG module path"
                         ToolTipService.ToolTip="Path to the PowerSTIG module file. PowerSTIG is a Microsoft tool that compiles STIG rules into automated configuration scripts. Optional."/>
              <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding BrowsePowerStigModuleCommand}"
                      AutomationProperties.Name="Browse for PowerSTIG module"
                      ToolTipService.ToolTip="Open a file picker to find the PowerSTIG module file."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,2">
              <TextBlock Text="Data file:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding PowerStigDataFile}"
                       AutomationProperties.Name="PowerSTIG data file"
                         ToolTipService.ToolTip="Optional data file for PowerSTIG. Leave blank and STIGForge will auto-generate one from your bundle."/>
              <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding BrowsePowerStigDataCommand}"
                      AutomationProperties.Name="Browse for PowerSTIG data"
                      ToolTipService.ToolTip="Open a file picker to find a custom PowerSTIG data file."/>
            </WrapPanel>
            <TextBlock Text="Leave empty to auto-generate from bundle controls and profile overrides. Only set this if you have a custom .psd1 file."
                       Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="130,0,0,6"/>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Output path:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="420" Text="{Binding PowerStigOutputPath}"
                       AutomationProperties.Name="PowerSTIG output path"
                         ToolTipService.ToolTip="Where PowerSTIG saves its output. Leave blank to use the default location inside your bundle."/>
              <CheckBox Content="Verbose" IsChecked="{Binding PowerStigVerbose}" Margin="12,0,0,0" VerticalAlignment="Center"
                        AutomationProperties.Name="PowerSTIG verbose logging"
                        ToolTipService.ToolTip="Enable verbose PowerSTIG compile output in apply logs."/>
            </WrapPanel>
          </StackPanel>
        </Border>

        <!-- Toolkit + Scanner Paths -->
        <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,8" Background="{DynamicResource SurfaceBrush}">
          <StackPanel>
            <TextBlock Text="Toolkit &amp; Scanners" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Toolkit root:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding LocalToolkitRoot}"
                       AutomationProperties.Name="Toolkit root path"
                         ToolTipService.ToolTip="Folder where you extracted the DISA STIG/SCAP toolkit download. Contains scanner tools and utilities."/>
              <Button Content="Activate" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding ActivateToolkitCommand}"
                      AutomationProperties.Name="Activate toolkit"
                      ToolTipService.ToolTip="Auto-configure Evaluate-STIG, SCC, and PowerSTIG from toolkit files."/>
            </WrapPanel>
            <TextBlock Text="{Binding ToolkitActivationStatus}" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8"/>

            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Eval-STIG preset:" Width="130" VerticalAlignment="Center"/>
              <ComboBox Width="300" ItemsSource="{Binding EvaluateStigPresets}" SelectedItem="{Binding SelectedEvalStigPreset}"
                        AutomationProperties.Name="Evaluate-STIG preset"
                         ToolTipService.ToolTip="Pick from common scanner settings. Choose 'Custom' to type your own options in the args field below."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Evaluate-STIG:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding EvaluateStigRoot}"
                       AutomationProperties.Name="Evaluate-STIG root"
                         ToolTipService.ToolTip="Folder containing the Evaluate-STIG scanner script (Evaluate-STIG.ps1) from DISA."/>
              <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding BrowseEvaluateStigCommand}"
                      AutomationProperties.Name="Browse for Evaluate-STIG"
                      ToolTipService.ToolTip="Open a folder picker to find your Evaluate-STIG installation."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="Eval-STIG args:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding EvaluateStigArgs}" IsEnabled="{Binding IsEvalStigCustomArgs}"
                       AutomationProperties.Name="Evaluate-STIG arguments"
                       ToolTipService.ToolTip="Custom scanner options. Only editable when the preset above is set to 'Custom'."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="SCAP command:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding ScapCommandPath}"
                       AutomationProperties.Name="SCAP command path"
                         ToolTipService.ToolTip="Path to the SCC (SCAP Compliance Checker) scanner program from DISA."/>
              <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                      Command="{Binding BrowseScapCommandCommand}"
                      AutomationProperties.Name="Browse for SCAP command"
                      ToolTipService.ToolTip="Open a file picker to find the SCAP scanner executable."/>
            </WrapPanel>
            <WrapPanel Margin="0,0,0,6">
              <TextBlock Text="SCAP args:" Width="130" VerticalAlignment="Center"/>
              <TextBox Width="520" Text="{Binding ScapArgs}"
                       AutomationProperties.Name="SCAP arguments"
                       ToolTipService.ToolTip="Extra command-line options for the SCAP scanner. Leave blank for defaults."/>
            </WrapPanel>
          </StackPanel>
        </Border>

        <!-- Run Button -->
        <WrapPanel Margin="0,0,0,8">
          <Button Content="Run Orchestration" MinWidth="180" Height="38" Padding="14,0" FontWeight="SemiBold"
                  Command="{Binding OrchestrateCommand}" IsEnabled="{Binding ActionsEnabled}"
                  AutomationProperties.Name="Run orchestration"
                  ToolTipService.ToolTip="Execute apply, verify, and export according to selected toggles and inputs."/>
          <TextBlock Text="{Binding OrchStatus}" Margin="12,10,0,0" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
        </WrapPanel>
        <TextBlock Text="{Binding GuidedNextAction}" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,0,0,4"/>

      </StackPanel>
    </ScrollViewer>

    <!-- Separator -->
    <Separator Grid.Row="1" Margin="0,4,0,4"/>

    <!-- Orchestration Log -->
    <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Background="{DynamicResource SurfaceBrush}">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <TextBlock Text="{Binding OrchLog}" FontFamily="Consolas" FontSize="11" Padding="8" TextWrapping="Wrap"
                   AutomationProperties.Name="Orchestration log output"/>
      </ScrollViewer>
    </Border>
  </Grid>
</UserControl>
