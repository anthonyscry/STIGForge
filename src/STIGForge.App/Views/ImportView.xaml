<UserControl x:Class="STIGForge.App.Views.ImportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="0" Margin="0,0,0,10">
      <WrapPanel Margin="0,0,0,8">
        <Button Content="Scan Import Folder" MinWidth="170" Height="32" Padding="16,0" Margin="0,0,12,4"
                Command="{Binding ScanImportFolderCommand}"
                AutomationProperties.Name="Scan import folder"
                ToolTipService.ToolTip="Scan the STIGForge import folder for ZIP bundles and auto-import content/tools."/>
        <Button Content="Open Import Folder" MinWidth="170" Height="32" Padding="16,0" Margin="0,0,12,4"
                Command="{Binding OpenImportFolderCommand}"
                AutomationProperties.Name="Open import folder"
                ToolTipService.ToolTip="Open the standard STIGForge import folder in Explorer."/>
        <Button Content="Compare Packs..." MinWidth="150" Height="32" Padding="16,0" Margin="0,0,12,4"
                Command="{Binding ComparePacksCommand}"
                AutomationProperties.Name="Compare content packs"
                ToolTipService.ToolTip="Compare two content packs to see added, removed, or changed controls."/>
        <Button Content="Select Content..." MinWidth="150" Height="32" Padding="16,0" Margin="0,0,0,4"
                Command="{Binding OpenContentPickerCommand}"
                AutomationProperties.Name="Select content for mission"
                ToolTipService.ToolTip="Pick from imported packs for this mission. Multi-select supported."/>
      </WrapPanel>

      <WrapPanel Margin="0,0,0,2">
        <TextBlock Text="Import folder:" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,6,0"/>
        <TextBlock Text="{Binding ScanImportFolderPath}" Foreground="{DynamicResource TextMutedBrush}" TextTrimming="CharacterEllipsis"/>
      </WrapPanel>

      <TextBlock Text="{Binding ImportHint}" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,2"/>

      <TabControl Margin="0,4,0,2">
        <TabItem Header="Local Machine Scan">
          <Grid Margin="8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Button Content="Scan Local Machine" MinWidth="150" Height="28" Padding="12,0" HorizontalAlignment="Left"
                    Command="{Binding ScanMachineApplicabilityCommand}"
                    ToolTipService.ToolTip="Detect OS version, roles, and installed features for STIG applicability."/>

            <ItemsControl Grid.Row="1" ItemsSource="{Binding MachineScanTags}" Margin="0,8,0,2">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <WrapPanel/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Height="30" MinWidth="170" MaxWidth="240" Margin="0,0,8,8" Padding="10,0"
                          CornerRadius="15"
                          BorderBrush="{DynamicResource BorderBrush}"
                          BorderThickness="1"
                          Background="{DynamicResource SurfaceMutedBrush}"
                          ToolTip="{Binding ToolTip}">
                    <TextBlock Text="{Binding Text}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock Grid.Row="2" Text="{Binding MachineApplicabilityStatus}" Foreground="{DynamicResource TextMutedBrush}" FontSize="11"
                       TextWrapping="Wrap" Margin="0,0,0,0"/>
          </Grid>
        </TabItem>

        <TabItem Header="AD Remote Scan">
          <StackPanel Margin="8">
            <TextBlock Text="Target hosts (comma or newline separated):" Foreground="{DynamicResource TextMutedBrush}"/>
            <TextBox Text="{Binding AdRemoteTargets, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" Height="70"
                     VerticalScrollBarVisibility="Auto" Margin="0,4,0,6"
                     ToolTipService.ToolTip="Example: host01,host02 or one hostname per line"/>
            <WrapPanel Margin="0,0,0,4">
              <Button Content="Scan Remote Hosts" MinWidth="150" Height="28" Padding="12,0"
                      Command="{Binding ScanRemoteMachineApplicabilityCommand}"
                      ToolTipService.ToolTip="Checks remote host reachability for AD/fleet-style scan workflows."/>
            </WrapPanel>
            <TextBlock Text="{Binding AdRemoteScanStatus}" Foreground="{DynamicResource TextMutedBrush}" FontSize="11"
                       TextWrapping="Wrap" Margin="0,2,0,0"/>
          </StackPanel>
        </TabItem>
      </TabControl>

      <TextBlock Text="{Binding SelectedContentSummary}" Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="0,2,0,0"/>
    </StackPanel>

    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <Grid Grid.Column="0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" Margin="0,0,0,8">
          <TextBox DockPanel.Dock="Right" Width="180" Text="{Binding ContentSearchText, UpdateSourceTrigger=PropertyChanged}"
                   AutomationProperties.Name="Search content library"
                   ToolTipService.ToolTip="Filter by name or pack ID"/>
          <TextBlock DockPanel.Dock="Right" Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0"
                     Foreground="{DynamicResource TextMutedBrush}"/>
          <StackPanel Orientation="Horizontal">
            <RadioButton Content="All" GroupName="ContentFilter" IsChecked="{Binding IsFilterAll}" Padding="10,4" Margin="0,0,6,0"/>
            <RadioButton Content="STIG" GroupName="ContentFilter" IsChecked="{Binding IsFilterStig}" Padding="10,4" Margin="0,0,6,0"/>
            <RadioButton Content="SCAP" GroupName="ContentFilter" IsChecked="{Binding IsFilterScap}" Padding="10,4" Margin="0,0,6,0"/>
            <RadioButton Content="GPO" GroupName="ContentFilter" IsChecked="{Binding IsFilterGpo}" Padding="10,4" Margin="0,0,6,0"/>
            <RadioButton Content="ADMX" GroupName="ContentFilter" IsChecked="{Binding IsFilterAdmx}" Padding="10,4"/>
          </StackPanel>
        </DockPanel>

        <Border Grid.Row="1" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Margin="0,0,0,8">
          <ListView x:Name="ContentLibraryList" ItemsSource="{Binding FilteredContentLibrary}" SelectedItem="{Binding SelectedLibraryItem}"
                     SelectionMode="Extended" MinHeight="80"
                     SelectionChanged="ContentLibraryList_SelectionChanged"
                     GridViewColumnHeader.Click="ColumnHeader_Click"
                     VirtualizingStackPanel.IsVirtualizing="True"
                     VirtualizingStackPanel.VirtualizationMode="Recycling"
                     ScrollViewer.CanContentScroll="True"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Auto">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="200"/>
                <GridViewColumn Header="Format" DisplayMemberBinding="{Binding Format}" Width="80"/>
                <GridViewColumn Header="PackId" DisplayMemberBinding="{Binding PackId}" Width="150"/>
                <GridViewColumn Header="Imported" DisplayMemberBinding="{Binding ImportedAtLabel}" Width="140"/>
                <GridViewColumn Header="Source" DisplayMemberBinding="{Binding SourceLabel}" Width="120"/>
              </GridView>
            </ListView.View>
          </ListView>
        </Border>

        <WrapPanel Grid.Row="2">
          <Button Content="Select All" MinWidth="100" Height="30" Padding="14,0" Margin="0,0,10,4"
                  Click="SelectAllLibraryItems_Click"
                  AutomationProperties.Name="Select all library items"
                  ToolTipService.ToolTip="Select all packs in the filtered list (Ctrl+A also works)."/>
          <Button Content="Refresh Library" MinWidth="140" Height="30" Padding="14,0" Margin="0,0,10,4"
                  Command="{Binding RefreshImportLibraryCommand}"
                  AutomationProperties.Name="Refresh import library"
                  ToolTipService.ToolTip="Re-scan the import library for new or changed items."/>
          <Button Content="Open Pack" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                  Command="{Binding OpenPackFolderCommand}"
                  AutomationProperties.Name="Open pack folder"
                  ToolTipService.ToolTip="Open the selected content pack folder in Windows Explorer."/>
          <Button Content="Export Map" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                  Command="{Binding ExportPowerStigMapCommand}"
                  AutomationProperties.Name="Export PowerSTIG map"
                  ToolTipService.ToolTip="Export a PowerSTIG control-to-rule mapping file for the selected pack."/>
          <Button Content="Delete Selected" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,0,4"
                  Command="{Binding DeleteSelectedPacksCommand}" Foreground="{DynamicResource DangerBrush}"
                  AutomationProperties.Name="Delete selected packs"
                  ToolTipService.ToolTip="Permanently remove selected content packs from local storage. Shift/Ctrl+click to multi-select."/>
        </WrapPanel>
      </Grid>

      <Border Grid.Column="1" Margin="12,0,0,0" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
        <StackPanel Margin="10">
          <TextBlock Text="Pack Details" FontWeight="SemiBold"/>
          <TextBlock Text="Name:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailName}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="PackId:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailId}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Format:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailFormat}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Release date:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailReleaseDate}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Imported:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailImportedAt}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Source:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailSource}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Hash:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailHash}" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
          <TextBlock Text="Controls:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailControls}" Foreground="{DynamicResource TextMutedBrush}"/>
          <TextBlock Text="Root:" Margin="0,6,0,0"/>
          <TextBlock Text="{Binding PackDetailRoot}" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
          <TextBlock Text="{Binding ImportLibraryStatus}" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,10,0,0" FontSize="11"/>
        </StackPanel>
      </Border>
    </Grid>
  </Grid>
</UserControl>
