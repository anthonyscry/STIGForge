<UserControl x:Class="STIGForge.App.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <Border Grid.Row="0" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,8" Background="{DynamicResource SurfaceMutedBrush}">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <StackPanel Grid.Column="0">
                <TextBlock Text="Active Bundle" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Bundle:" FontWeight="SemiBold" Width="80"/>
                   <TextBlock Text="{Binding DashBundleLabel}" Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Pack:" FontWeight="SemiBold" Width="80"/>
                   <TextBlock Text="{Binding DashPackLabel}" Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Profile:" FontWeight="SemiBold" Width="80"/>
                   <TextBlock Text="{Binding DashProfileLabel}" Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
              </StackPanel>
              <Button Grid.Column="1" Content="Refresh" Width="80" Height="28" VerticalAlignment="Top" TabIndex="10"
                      Command="{Binding DashRefreshCommand}"
                      AutomationProperties.Name="Refresh dashboard"
                      ToolTipService.ToolTip="Reload bundle status, control totals, and compliance metrics."/>
            </Grid>
          </Border>

          <Grid Grid.Row="1" Margin="0,0,0,8"
                Visibility="{Binding DashHasBundle, Converter={StaticResource BoolToVisibility}}">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

             <Border Grid.Column="0" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceBrush}">
              <StackPanel>
                <TextBlock Text="Controls" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                 <TextBlock Text="{Binding DashTotalControls}" FontSize="36" FontWeight="Bold" Foreground="{DynamicResource AccentBrush}"/>
                 <TextBlock Text="Total Controls" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Automated:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashAutoControls}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Manual:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualControls}"/>
                </StackPanel>
              </StackPanel>
            </Border>

             <Border Grid.Column="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceBrush}">
              <StackPanel>
                <TextBlock Text="Automated Verification" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                 <TextBlock Text="{Binding DashVerifyPercent}" FontSize="36" FontWeight="Bold" Foreground="{DynamicResource SuccessBrush}"/>
                 <TextBlock Text="Compliance Rate" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Closed:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashVerifyClosed}" Foreground="{DynamicResource SuccessBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Open:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashVerifyOpen}" Foreground="{DynamicResource DangerBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Last run:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashLastVerify}" Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
              </StackPanel>
            </Border>

             <Border Grid.Column="4" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceBrush}">
              <StackPanel>
                <TextBlock Text="Manual Review" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                 <TextBlock Text="{Binding DashManualPercent}" FontSize="36" FontWeight="Bold" Foreground="{DynamicResource WarningBrush}"/>
                 <TextBlock Text="Answered Rate" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Pass:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashManualPass}" Foreground="{DynamicResource SuccessBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Fail:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashManualFail}" Foreground="{DynamicResource DangerBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="N/A:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashManualNa}" Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Open:" FontWeight="SemiBold" Width="90"/>
                   <TextBlock Text="{Binding DashManualOpen}" Foreground="{DynamicResource WarningBrush}"/>
                </StackPanel>
              </StackPanel>
            </Border>
           </Grid>

          <TextBlock Grid.Row="1" Text="No active bundle. Select or build a bundle to see compliance metrics."
                     VerticalAlignment="Center" HorizontalAlignment="Center" TextAlignment="Center"
                     Foreground="{DynamicResource TextMutedBrush}" FontSize="14" TextWrapping="Wrap" MaxWidth="500" Margin="0,20,0,20">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility" Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding DashHasBundle}" Value="False">
                    <Setter Property="Visibility" Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>

            <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceBrush}"
                    Visibility="{Binding DashHasBundle, Converter={StaticResource BoolToVisibility}}">
            <StackPanel>
              <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceMutedBrush}" Margin="0,0,0,12">
                <StackPanel>
                  <TextBlock Text="Compliance Trend" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                  <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Rectangle Width="12" Height="12" Fill="{DynamicResource SuccessBrush}" Margin="0,0,4,0"/>
                    <TextBlock Text="Pass" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,12,0"/>
                    <Rectangle Width="12" Height="12" Fill="{DynamicResource DangerBrush}" Margin="0,0,4,0"/>
                    <TextBlock Text="Fail" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,12,0"/>
                    <Rectangle Width="12" Height="12" Fill="{DynamicResource TextMutedBrush}" Margin="0,0,4,0"/>
                    <TextBlock Text="Open" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,12,0"/>
                    <Rectangle Width="12" Height="12" Fill="{DynamicResource AccentBrush}" Margin="0,0,4,0"/>
                    <TextBlock Text="N/A" Foreground="{DynamicResource TextMutedBrush}"/>
                  </StackPanel>
                  <TextBlock Text="No trend data yet. Refresh the dashboard to capture a snapshot."
                             Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8" HorizontalAlignment="Center">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding TrendSnapshots.Count}" Value="0">
                            <Setter Property="Visibility" Value="Visible"/>
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                  <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding TrendSnapshots}">
                      <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                          <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom"/>
                        </ItemsPanelTemplate>
                      </ItemsControl.ItemsPanel>
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <StackPanel Margin="0,0,8,0" VerticalAlignment="Bottom">
                            <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Background="{DynamicResource SurfaceBrush}" Padding="4" Height="210">
                              <Grid Width="28" Height="200" VerticalAlignment="Bottom">
                                <Grid.RowDefinitions>
                                  <RowDefinition Height="{Binding NotApplicableCount, StringFormat={}{0}*}"/>
                                  <RowDefinition Height="{Binding OpenCount, StringFormat={}{0}*}"/>
                                  <RowDefinition Height="{Binding FailCount, StringFormat={}{0}*}"/>
                                  <RowDefinition Height="{Binding PassCount, StringFormat={}{0}*}"/>
                                </Grid.RowDefinitions>
                                <Rectangle Grid.Row="0" Fill="{DynamicResource AccentBrush}"/>
                                <Rectangle Grid.Row="1" Fill="{DynamicResource TextMutedBrush}"/>
                                <Rectangle Grid.Row="2" Fill="{DynamicResource DangerBrush}"/>
                                <Rectangle Grid.Row="3" Fill="{DynamicResource SuccessBrush}"/>
                              </Grid>
                            </Border>
                            <TextBlock Text="{Binding Timestamp, StringFormat={}{0:MM-dd}}" HorizontalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,0"/>
                            <TextBlock Text="{Binding Timestamp, StringFormat={}{0:HH:mm}}" HorizontalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextMutedBrush}"/>
                          </StackPanel>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </ScrollViewer>
                </StackPanel>
              </Border>

              <TextBlock Text="Quick Actions" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
              <StackPanel Orientation="Horizontal">
                <Button Content="Run Apply" Width="120" Height="32" TabIndex="20" Command="{Binding ApplyRunCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"
                        AutomationProperties.Name="Run apply"
                        ToolTipService.ToolTip="Execute the apply phase on the active bundle (snapshot + hardening scripts)."/>
                <Button Content="Run Verify" Width="120" Height="32" TabIndex="21" Command="{Binding VerifyRunCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"
                        AutomationProperties.Name="Run verify"
                        ToolTipService.ToolTip="Run Evaluate-STIG and/or SCAP verification against the active bundle."/>
                <Button Content="Export eMASS" Width="120" Height="32" TabIndex="22" Command="{Binding ExportEmassCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"
                        AutomationProperties.Name="Export eMASS package"
                        ToolTipService.ToolTip="Generate an eMASS-ready export package from current bundle findings."/>
                <Button Content="Launch Wizard" Width="120" Height="32" TabIndex="23" Command="{Binding LaunchManualWizardCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"
                        AutomationProperties.Name="Launch manual review wizard"
                        ToolTipService.ToolTip="Open the guided manual control review wizard for unanswered controls."/>
                <Button Content="Compare Packs" Width="120" Height="32" TabIndex="24" Command="{Binding ComparePacksCommand}" Margin="0,0,8,0"
                        AutomationProperties.Name="Compare content packs"
                        ToolTipService.ToolTip="Compare two content packs to see added, removed, or changed controls."/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
               <TextBlock Text="Last eMASS export:" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,8,0"/>
                 <TextBlock Text="{Binding DashLastExport}" Foreground="{DynamicResource TextMutedBrush}"/>
              </StackPanel>
               <TextBlock Text="{Binding DashMissionSeverity}" Margin="0,8,0,0" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
               <TextBlock Text="{Binding DashRecoveryGuidance}" Margin="0,4,0,0" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
            </StackPanel>
          </Border>
        </Grid>
      
</UserControl>
