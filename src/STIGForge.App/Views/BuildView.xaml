<UserControl x:Class="STIGForge.App.Views.BuildView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Margin="10">

      <TextBlock Text="Build Bundle" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,4"/>
      <TextBlock Text="Review your mission-selected content packs, choose a profile, then build offline bundles containing Apply, Verify, Manual, Evidence, and Reports artifacts."
                 Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,0,0,12"/>

      <!-- Pack + Profile Selection -->
      <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,10" Background="{DynamicResource SurfaceMutedBrush}">
        <StackPanel>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Content:" Width="110" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding SelectedContentSummary}" VerticalAlignment="Center" Width="360" TextWrapping="Wrap"
                       Foreground="{DynamicResource TextMutedBrush}"
                       AutomationProperties.Name="Selected content packs"
                       ToolTipService.ToolTip="Content packs selected via Import → Select Content. One bundle is built per pack."/>
            <Button Content="Select Content…" MinWidth="130" Height="28" Padding="14,0" Margin="6,0,0,0"
                    Command="{Binding OpenContentPickerCommand}"
                    AutomationProperties.Name="Select content packs"
                    ToolTipService.ToolTip="Pick content packs for this build from the Import library."/>
          </WrapPanel>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Profile:" Width="110" VerticalAlignment="Center"/>
            <ComboBox Width="360" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}" DisplayMemberPath="Name"
                      AutomationProperties.Name="Build profile"
                      ToolTipService.ToolTip="Select the profile to use for the bundle build."/>
          </WrapPanel>
          <WrapPanel Margin="0,0,0,8">
            <Button Content="Build Bundle" MinWidth="160" Height="36" Padding="14,0" Margin="0,0,10,0" FontWeight="SemiBold"
                    Command="{Binding BuildBundleCommand}" IsEnabled="{Binding ActionsEnabled}"
                    AutomationProperties.Name="Build bundle"
                    ToolTipService.ToolTip="Generate offline Apply/Verify/Manual/Evidence/Reports artifacts for this pack/profile pair."/>
            <TextBlock Text="{Binding BuildGateStatus}" VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- Bundle Path -->
      <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,10" Background="{DynamicResource SurfaceBrush}">
        <StackPanel>
          <TextBlock Text="Active Bundle" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Path:" Width="60" VerticalAlignment="Center"/>
            <TextBox Width="600" Text="{Binding BundleRoot}" IsReadOnly="True"
                     AutomationProperties.Name="Bundle root path"
                     ToolTipService.ToolTip="Path to the active bundle root folder."/>
            <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                    Command="{Binding BrowseBundleCommand}"
                    AutomationProperties.Name="Browse for bundle"
                    ToolTipService.ToolTip="Pick Manifest/manifest.json from a bundle."/>
            <Button Content="Open" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                    Command="{Binding OpenBundleFolderCommand}"
                    AutomationProperties.Name="Open bundle folder"
                    ToolTipService.ToolTip="Open the active bundle folder in Explorer."/>
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- Recent Bundles -->
      <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceBrush}">
        <StackPanel>
          <TextBlock Text="Recent Bundles" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
           <ListBox ItemsSource="{Binding RecentBundles}"
                    SelectedItem="{Binding SelectedRecentBundle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsSynchronizedWithCurrentItem="True"
                    SelectionMode="Single"
                    MaxHeight="160" MinHeight="32"
                    Background="{DynamicResource SurfaceBrush}"
                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                    VirtualizingPanel.IsVirtualizing="True"
                    VirtualizingPanel.VirtualizationMode="Recycling"
                    ScrollViewer.CanContentScroll="True"
                    AutomationProperties.Name="Recent bundles"
                    ToolTipService.ToolTip="Previously built bundle paths. Click to select, then Use or Delete.">
             <ListBox.ItemTemplate>
               <DataTemplate>
                 <TextBlock Text="{Binding}" TextTrimming="CharacterEllipsis"
                            ToolTipService.ToolTip="{Binding}"/>
               </DataTemplate>
             </ListBox.ItemTemplate>
           </ListBox>
          <WrapPanel Margin="0,6,0,0">
            <Button Content="Use Selected" MinWidth="110" Height="28" Padding="14,0" Margin="0,0,6,0"
                    Command="{Binding UseRecentBundleCommand}"
                    AutomationProperties.Name="Use recent bundle"
                    ToolTipService.ToolTip="Load the selected recent bundle as the active bundle."/>
            <Button Content="Delete Selected" MinWidth="110" Height="28" Padding="14,0"
                    Command="{Binding DeleteSelectedRecentBundleCommand}"
                    AutomationProperties.Name="Delete selected recent bundle"
                    ToolTipService.ToolTip="Permanently delete the selected recent bundle folder."/>
          </WrapPanel>
        </StackPanel>
      </Border>

    </StackPanel>
  </ScrollViewer>
</UserControl>
