<UserControl x:Class="STIGForge.App.Views.ManualView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <Grid Margin="10">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <!-- Wizard + Filter Bar -->
      <WrapPanel Grid.Row="0" Margin="0,0,0,8">
        <Button Content="Launch Review Wizard" MinWidth="170" Height="32" Padding="14,0" Margin="0,0,12,0"
                Command="{Binding LaunchManualWizardCommand}" IsEnabled="{Binding ActionsEnabled}"
                AutomationProperties.Name="Launch manual review wizard"
                ToolTipService.ToolTip="Open the guided wizard for step-by-step manual control review and disposition."/>
        <TextBlock Text="Step-by-step wizard for reviewing manual controls with guided workflow"
                   Margin="0,8,0,0" Foreground="{DynamicResource TextMutedBrush}"/>
      </WrapPanel>

      <WrapPanel Grid.Row="1" Margin="0,0,0,8">
        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0"/>
        <TextBox Width="240" Text="{Binding ManualFilterText, UpdateSourceTrigger=PropertyChanged}"
                 AutomationProperties.Name="Search manual controls"
                 ToolTipService.ToolTip="Type to filter controls by rule ID, title, or check text."/>
        <TextBlock Text="Status:" VerticalAlignment="Center" Margin="16,0,6,0"/>
        <ComboBox Width="140" ItemsSource="{Binding ManualStatusFilters}" SelectedItem="{Binding ManualStatusFilter}"
                  AutomationProperties.Name="Status filter"
                  ToolTipService.ToolTip="Filter controls by disposition status."/>
      </WrapPanel>

      <!-- Summary -->
      <TextBlock Grid.Row="2" Text="{Binding ManualSummary}" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,8"/>

      <!-- Control List + Tabbed Detail -->
      <Grid Grid.Row="3">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <ListView Grid.Column="0" ItemsSource="{Binding ManualControlsView}" SelectedItem="{Binding SelectedManualControl}"
                  VirtualizingStackPanel.IsVirtualizing="True"
                  VirtualizingStackPanel.VirtualizationMode="Recycling"
                  ScrollViewer.CanContentScroll="True">
          <ListView.View>
            <GridView>
              <GridViewColumn Header="Rule" DisplayMemberBinding="{Binding Control.ExternalIds.RuleId}"/>
              <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Control.Title}" Width="260"/>
              <GridViewColumn Header="Stat" DisplayMemberBinding="{Binding Status}"/>
            </GridView>
          </ListView.View>
        </ListView>

        <TabControl Grid.Column="1" Margin="12,0,0,0">

          <!-- Details Tab -->
          <TabItem Header="Details">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <StackPanel Margin="12">
                <TextBlock Text="Selected Control" FontSize="15" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <TextBlock Text="{Binding SelectedManualControl.Control.Title}" TextWrapping="Wrap" FontSize="13" Margin="0,0,0,10"/>
                <TextBlock Text="Check Text" FontWeight="SemiBold" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,4"/>
                <TextBlock Text="{Binding SelectedManualControl.Control.CheckText}" TextWrapping="Wrap" Foreground="{DynamicResource TextMutedBrush}"/>
              </StackPanel>
            </ScrollViewer>
          </TabItem>

          <!-- Disposition Tab -->
          <TabItem Header="Disposition">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <StackPanel Margin="12">
                <WrapPanel Margin="0,0,0,10">
                  <TextBlock Text="Status:" Width="80" VerticalAlignment="Center"/>
                  <ComboBox Width="160" ItemsSource="{Binding ManualStatuses}" SelectedItem="{Binding ManualStatus}"
                            AutomationProperties.Name="Manual control status"/>
                </WrapPanel>

                <TextBlock Text="Reason:" Margin="0,0,0,4"/>
                <TextBox Text="{Binding ManualReason}" Height="40" TextWrapping="Wrap"
                         AutomationProperties.Name="Manual control reason"
                         ToolTipService.ToolTip="Required for Fail and NotApplicable dispositions."/>

                <TextBlock Text="Comment:" Margin="0,12,0,4"/>
                <TextBox Text="{Binding ManualComment}" Height="80" TextWrapping="Wrap"
                         AutomationProperties.Name="Manual control comment"/>

                <WrapPanel Margin="0,12,0,0">
                  <Button Content="Save Answer" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                          Command="{Binding SaveManualAnswerCommand}"
                          AutomationProperties.Name="Save manual answer"
                          ToolTipService.ToolTip="Save the status, reason, and comment for the selected manual control."/>
                </WrapPanel>
                <TextBlock Text="Fail and NotApplicable require a reason." Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="0,4,0,0"/>
              </StackPanel>
            </ScrollViewer>
          </TabItem>

          <!-- Evidence Tab -->
          <TabItem Header="Evidence">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <StackPanel Margin="12">
                <!-- Evidence Actions for selected control -->
                <TextBlock Text="Control Evidence Actions" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                <WrapPanel Margin="0,0,0,12">
                  <Button Content="Use for Evidence" MinWidth="140" Height="30" Padding="14,0" Margin="0,0,10,4"
                          Command="{Binding UseSelectedControlForEvidenceCommand}"
                          AutomationProperties.Name="Use control for evidence"
                          ToolTipService.ToolTip="Copy the selected control's RuleId to the Evidence section below."/>
                  <Button Content="Collect Evidence" MinWidth="140" Height="30" Padding="14,0" Margin="0,0,10,4"
                          Command="{Binding CollectSelectedControlEvidenceCommand}"
                          AutomationProperties.Name="Collect evidence for control"
                          ToolTipService.ToolTip="Auto-collect evidence artifacts for the selected control."/>
                  <Button Content="Open Evidence Folder" MinWidth="160" Height="30" Padding="14,0" Margin="0,0,0,4"
                          Command="{Binding OpenSelectedControlEvidenceFolderCommand}"
                          AutomationProperties.Name="Open evidence folder"
                          ToolTipService.ToolTip="Open the evidence folder for the selected control in Windows Explorer."/>
                </WrapPanel>

                <!-- Evidence Capture Panel -->
                <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Background="{DynamicResource SurfaceMutedBrush}">
                  <StackPanel>
                    <TextBlock Text="Evidence Capture" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <WrapPanel Margin="0,0,0,6">
                      <TextBlock Text="RuleId:" Width="80" VerticalAlignment="Center"/>
                      <TextBox Width="260" Text="{Binding EvidenceRuleId}" AutomationProperties.Name="Evidence rule ID"/>
                      <TextBlock Text="Type:" Width="60" Margin="12,0,0,0" VerticalAlignment="Center"/>
                      <ComboBox Width="160" ItemsSource="{Binding EvidenceTypes}" SelectedItem="{Binding EvidenceType}"
                                AutomationProperties.Name="Evidence type"/>
                    </WrapPanel>
                    <TextBlock Text="Evidence text:" Margin="0,0,0,2"/>
                    <TextBox Height="60" TextWrapping="Wrap" Text="{Binding EvidenceText}" AutomationProperties.Name="Evidence text"/>
                    <WrapPanel Margin="0,6,0,0">
                      <TextBlock Text="File:" Width="80" VerticalAlignment="Center"/>
                      <TextBox Width="420" Text="{Binding EvidenceFilePath}" AutomationProperties.Name="Evidence file path"/>
                      <Button Content="Browse" MinWidth="80" Height="28" Padding="14,0" Margin="6,0,0,0"
                              Command="{Binding BrowseEvidenceFileCommand}" AutomationProperties.Name="Browse for evidence file"/>
                    </WrapPanel>
                    <WrapPanel Margin="0,8,0,0">
                      <Button Content="Save Evidence" MinWidth="140" Height="30" Padding="14,0"
                              Command="{Binding SaveEvidenceCommand}"
                              AutomationProperties.Name="Save evidence record"
                              ToolTipService.ToolTip="Save the evidence text, file attachment, and type for the specified RuleId."/>
                      <TextBlock Text="{Binding EvidenceStatus}" Margin="12,8,0,0" Foreground="{DynamicResource TextMutedBrush}"/>
                    </WrapPanel>
                  </StackPanel>
                </Border>
              </StackPanel>
            </ScrollViewer>
          </TabItem>

        </TabControl>
      </Grid>
    </Grid>
  </ScrollViewer>
</UserControl>
