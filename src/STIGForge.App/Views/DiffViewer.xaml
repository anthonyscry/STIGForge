<Window x:Class="STIGForge.App.Views.DiffViewer"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="STIG Pack Comparison" Height="800" Width="1400" WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
  </Window.Resources>
  
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Header -->
    <DockPanel Grid.Row="0" Margin="0,0,0,16">
      <TextBlock Text="STIG Pack Comparison" FontSize="20" FontWeight="SemiBold" DockPanel.Dock="Left"/>
      <Button Content="Export Report" Width="120" HorizontalAlignment="Right" DockPanel.Dock="Right"
              Command="{Binding ExportReportCommand}" Visibility="{Binding HasDiff, Converter={StaticResource BoolToVis}}"/>
    </DockPanel>

    <!-- Pack Selection & Summary -->
    <Grid Grid.Row="1" Margin="0,0,0,16">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      
      <!-- Pack Selection -->
      <Grid Grid.Row="0" Margin="0,0,0,12">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="16"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <StackPanel Grid.Column="0">
          <TextBlock Text="Baseline Pack:" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <TextBlock Text="{Binding BaselinePackName}" Foreground="Gray" FontSize="12"/>
        </StackPanel>
        
        <TextBlock Grid.Column="1" Text="â†’" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Gray"/>
        
        <StackPanel Grid.Column="2">
          <TextBlock Text="Target Pack:" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <TextBlock Text="{Binding TargetPackName}" Foreground="Gray" FontSize="12"/>
        </StackPanel>
      </Grid>
      
      <!-- Summary Stats -->
      <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Padding="12" Background="#F9F9F9"
              Visibility="{Binding HasDiff, Converter={StaticResource BoolToVis}}">
        <StackPanel Orientation="Horizontal">
          <StackPanel Orientation="Horizontal" Margin="0,0,24,0">
            <TextBlock Text="Added:" FontWeight="SemiBold" Margin="0,0,8,0"/>
            <TextBlock Text="{Binding AddedCount}" Foreground="Green"/>
          </StackPanel>
          
          <StackPanel Orientation="Horizontal" Margin="0,0,24,0">
            <TextBlock Text="Removed:" FontWeight="SemiBold" Margin="0,0,8,0"/>
            <TextBlock Text="{Binding RemovedCount}" Foreground="Red"/>
          </StackPanel>
          
          <StackPanel Orientation="Horizontal" Margin="0,0,24,0">
            <TextBlock Text="Modified:" FontWeight="SemiBold" Margin="0,0,8,0"/>
            <TextBlock Text="{Binding ModifiedCount}" Foreground="Orange"/>
          </StackPanel>
          
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="Unchanged:" FontWeight="SemiBold" Margin="0,0,8,0"/>
            <TextBlock Text="{Binding UnchangedCount}" Foreground="Gray"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </Grid>

    <!-- Diff Tabs -->
    <TabControl Grid.Row="2" Visibility="{Binding HasDiff, Converter={StaticResource BoolToVis}}">
      <!-- Added Controls -->
      <TabItem>
        <TabItem.Header>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="Added (" Foreground="Green"/>
            <TextBlock Text="{Binding AddedCount}" Foreground="Green"/>
            <TextBlock Text=")" Foreground="Green"/>
          </StackPanel>
        </TabItem.Header>
        
        <Grid Margin="8">
          <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
          </Grid.RowDefinitions>
          
          <!-- Added Controls List -->
          <ListView Grid.Row="0" ItemsSource="{Binding AddedControls}" SelectedItem="{Binding SelectedAddedControl}">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Control ID" DisplayMemberBinding="{Binding ControlId}" Width="140"/>
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Title}" Width="350"/>
                <GridViewColumn Header="Severity" DisplayMemberBinding="{Binding Severity}" Width="100"/>
              </GridView>
            </ListView.View>
          </ListView>
          
          <GridSplitter Grid.Row="1" Height="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="LightGray"/>
          
          <!-- Selected Control Details -->
          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
            <StackPanel Visibility="{Binding HasSelectedAddedControl, Converter={StaticResource BoolToVis}}">
              <TextBlock Text="Control Details:" FontWeight="SemiBold" Margin="0,0,0,8"/>
              
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Control ID: " FontWeight="SemiBold" Width="100"/>
                <TextBlock Text="{Binding SelectedAddedControl.ControlId}"/>
              </StackPanel>
              
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Severity: " FontWeight="SemiBold" Width="100"/>
                <TextBlock Text="{Binding SelectedAddedControl.Severity}"/>
              </StackPanel>
              
              <TextBlock Text="Title:" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <TextBlock Text="{Binding SelectedAddedControl.Title}" TextWrapping="Wrap" Margin="0,0,0,8"/>
              
              <TextBlock Text="Check Text:" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <Border BorderBrush="LightGray" BorderThickness="1" Padding="8" Background="White">
                <TextBlock Text="{Binding SelectedAddedControl.CheckText}" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
              </Border>
            </StackPanel>
          </ScrollViewer>
        </Grid>
      </TabItem>

      <!-- Removed Controls -->
      <TabItem>
        <TabItem.Header>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="Removed (" Foreground="Red"/>
            <TextBlock Text="{Binding RemovedCount}" Foreground="Red"/>
            <TextBlock Text=")" Foreground="Red"/>
          </StackPanel>
        </TabItem.Header>
        
        <Grid Margin="8">
          <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
          </Grid.RowDefinitions>
          
          <!-- Removed Controls List -->
          <ListView Grid.Row="0" ItemsSource="{Binding RemovedControls}" SelectedItem="{Binding SelectedRemovedControl}">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Control ID" DisplayMemberBinding="{Binding ControlId}" Width="140"/>
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Title}" Width="350"/>
                <GridViewColumn Header="Severity" DisplayMemberBinding="{Binding Severity}" Width="100"/>
              </GridView>
            </ListView.View>
          </ListView>
          
          <GridSplitter Grid.Row="1" Height="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="LightGray"/>
          
          <!-- Selected Control Details -->
          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
            <StackPanel Visibility="{Binding HasSelectedRemovedControl, Converter={StaticResource BoolToVis}}">
              <TextBlock Text="Control Details:" FontWeight="SemiBold" Margin="0,0,0,8"/>
              
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Control ID: " FontWeight="SemiBold" Width="100"/>
                <TextBlock Text="{Binding SelectedRemovedControl.ControlId}"/>
              </StackPanel>
              
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Severity: " FontWeight="SemiBold" Width="100"/>
                <TextBlock Text="{Binding SelectedRemovedControl.Severity}"/>
              </StackPanel>
              
              <TextBlock Text="Title:" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <TextBlock Text="{Binding SelectedRemovedControl.Title}" TextWrapping="Wrap" Margin="0,0,0,8"/>
              
              <TextBlock Text="Check Text:" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <Border BorderBrush="LightGray" BorderThickness="1" Padding="8" Background="White">
                <TextBlock Text="{Binding SelectedRemovedControl.CheckText}" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
              </Border>
            </StackPanel>
          </ScrollViewer>
        </Grid>
      </TabItem>

      <!-- Modified Controls -->
      <TabItem>
        <TabItem.Header>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="Modified (" Foreground="Orange"/>
            <TextBlock Text="{Binding ModifiedCount}" Foreground="Orange"/>
            <TextBlock Text=")" Foreground="Orange"/>
          </StackPanel>
        </TabItem.Header>
        
        <Grid Margin="8">
          <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
          </Grid.RowDefinitions>
          
          <!-- Modified Controls List -->
          <ListView Grid.Row="0" ItemsSource="{Binding ModifiedControls}" SelectedItem="{Binding SelectedModifiedItem}">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Control ID" DisplayMemberBinding="{Binding ControlId}" Width="140"/>
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Title}" Width="280"/>
                <GridViewColumn Header="Impact" Width="100">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <Border Background="{Binding ImpactColor}" Padding="4,2" CornerRadius="2">
                        <TextBlock Text="{Binding Impact}" Foreground="White" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                      </Border>
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
                <GridViewColumn Header="Changes" DisplayMemberBinding="{Binding ChangesSummary}" Width="250"/>
              </GridView>
            </ListView.View>
          </ListView>
          
          <GridSplitter Grid.Row="1" Height="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="LightGray"/>
          
          <!-- Field-Level Diff -->
          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
            <StackPanel Visibility="{Binding HasSelectedModifiedItem, Converter={StaticResource BoolToVis}}">
              <TextBlock Text="Field-Level Changes:" FontWeight="SemiBold" Margin="0,0,0,8"/>
              
              <ItemsControl ItemsSource="{Binding SelectedModifiedChanges}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border BorderBrush="LightGray" BorderThickness="1" Padding="8" Margin="0,0,0,8" Background="White">
                      <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                          <TextBlock Text="{Binding FieldName}" FontWeight="SemiBold" Margin="0,0,8,0"/>
                          <Border Background="{Binding ImpactColor}" Padding="4,2" CornerRadius="2">
                            <TextBlock Text="{Binding Impact}" Foreground="White" FontSize="10" FontWeight="SemiBold"/>
                          </Border>
                        </StackPanel>
                        
                        <!-- Old Value -->
                        <TextBlock Text="Before:" FontWeight="SemiBold" FontSize="11" Foreground="Red" Margin="0,0,0,2"/>
                        <Border Background="#FFEEEE" Padding="6" Margin="0,0,0,4">
                          <TextBlock Text="{Binding OldValue}" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
                        </Border>
                        
                        <!-- New Value -->
                        <TextBlock Text="After:" FontWeight="SemiBold" FontSize="11" Foreground="Green" Margin="0,4,0,2"/>
                        <Border Background="#EEFFEE" Padding="6">
                          <TextBlock Text="{Binding NewValue}" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
                        </Border>
                      </StackPanel>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </ScrollViewer>
        </Grid>
      </TabItem>
    </TabControl>

    <!-- Loading/No Diff Message -->
    <StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center"
                Visibility="{Binding HasDiff, Converter={StaticResource BoolToVis}, ConverterParameter=Inverted}">
      <TextBlock Text="{Binding StatusMessage}" FontSize="16" Foreground="Gray" TextAlignment="Center"/>
    </StackPanel>
  </Grid>
</Window>
