<UserControl x:Class="STIGForge.App.Views.ProfileView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Margin="10">

      <TextBlock Text="Profile Editor" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,4"/>
      <TextBlock Text="Configure hardening mode, classification, overlay rules, and NA policy. Save a profile before building a bundle."
                 Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,0,0,12"/>

      <!-- Profile Selector -->
      <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,10" Background="{DynamicResource SurfaceMutedBrush}">
        <StackPanel>
          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Profile:" Width="100" VerticalAlignment="Center"/>
            <ComboBox Width="300" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}" DisplayMemberPath="Name"
                      AutomationProperties.Name="Hardening profile"
                      ToolTipService.ToolTip="Select an existing profile to edit or create a new one by changing the name."/>
          </WrapPanel>

          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Name:" Width="100" VerticalAlignment="Center"/>
            <TextBox Width="320" Text="{Binding ProfileName}"
                     AutomationProperties.Name="Profile name"
                     ToolTipService.ToolTip="Display name for this profile. Change to create a new profile."/>
          </WrapPanel>

          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Mode:" Width="100" VerticalAlignment="Center"/>
            <ComboBox Width="140" SelectedItem="{Binding ProfileMode}"
                      AutomationProperties.Name="Apply mode"
                      ToolTipService.ToolTip="AuditOnly = scan only. Safe = non-destructive settings. Full = all settings including potentially breaking ones.">
              <ComboBoxItem>AuditOnly</ComboBoxItem>
              <ComboBoxItem>Safe</ComboBoxItem>
              <ComboBoxItem>Full</ComboBoxItem>
            </ComboBox>
            <TextBlock Text="Classification:" Width="100" Margin="20,0,0,0" VerticalAlignment="Center"/>
            <ComboBox Width="160" SelectedItem="{Binding ProfileClassification}"
                      AutomationProperties.Name="Classification"
                      ToolTipService.ToolTip="System classification level determines which controls are in scope.">
              <ComboBoxItem>Classified</ComboBoxItem>
              <ComboBoxItem>Unclassified</ComboBoxItem>
              <ComboBoxItem>Mixed</ComboBoxItem>
            </ComboBox>
          </WrapPanel>

          <CheckBox Content="Auto-NA out-of-scope controls" Margin="0,0,0,8" IsChecked="{Binding ProfileAutoNa}"
                    AutomationProperties.Name="Automatic NA for out-of-scope controls"
                    ToolTipService.ToolTip="Automatically mark controls as Not Applicable when they don't match the system classification."/>

          <WrapPanel Margin="0,0,0,8">
            <TextBlock Text="Grace days:" Width="100" VerticalAlignment="Center"/>
            <TextBox Width="80" Text="{Binding ProfileGraceDays}"
                     AutomationProperties.Name="Grace period days"
                     ToolTipService.ToolTip="Number of days after a STIG release before findings become overdue."/>
          </WrapPanel>

          <TextBlock Text="NA comment:" Margin="0,0,0,4"/>
          <TextBox Height="60" TextWrapping="Wrap" Text="{Binding ProfileNaComment}"
                   AutomationProperties.Name="NA comment template"
                   ToolTipService.ToolTip="Default comment applied to auto-NA controls. Explains why the control is not applicable."/>
        </StackPanel>
      </Border>

      <!-- Overlays -->
      <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="12" Margin="0,0,0,10" Background="{DynamicResource SurfaceBrush}">
        <StackPanel>
          <TextBlock Text="Overlays" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <TextBlock Text="Select which overlays to apply. Overlays add rule-level exceptions, custom severity, or site-specific requirements."
                     Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap" Margin="0,0,0,8"/>
          <ItemsControl ItemsSource="{Binding OverlayItems}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <CheckBox Content="{Binding Overlay.Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,2,0,2"/>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          <WrapPanel Margin="0,8,0,0">
            <Button Content="Edit Overlays" MinWidth="130" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding OpenOverlayEditorCommand}"
                    AutomationProperties.Name="Edit overlays"
                    ToolTipService.ToolTip="Open the overlay editor to adjust rule-level overrides."/>
            <Button Content="Rebase Overlay" MinWidth="140" Height="30" Padding="14,0" Margin="0,0,10,4"
                    Command="{Binding RebaseOverlayCommand}"
                    AutomationProperties.Name="Rebase overlay"
                    ToolTipService.ToolTip="Rebase an overlay onto a newer content pack version."/>
            <Button Content="Refresh" MinWidth="100" Height="30" Padding="14,0" Margin="0,0,0,4"
                    Command="{Binding RefreshOverlaysCommand}"
                    AutomationProperties.Name="Refresh overlays"
                    ToolTipService.ToolTip="Reload the overlay list from disk."/>
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- Save / Delete -->
      <WrapPanel Margin="0,0,0,0">
        <Button Content="Save Profile" MinWidth="140" Height="34" Padding="14,0" Margin="0,0,10,4" FontWeight="SemiBold"
                Command="{Binding SaveProfileCommand}"
                AutomationProperties.Name="Save profile"
                ToolTipService.ToolTip="Save mode, classification, NA policy, and overlay selection for future builds."/>
        <Button Content="Delete Profile" MinWidth="140" Height="34" Padding="14,0" Margin="0,0,0,4"
                Command="{Binding DeleteSelectedProfileCommand}" Foreground="{DynamicResource DangerBrush}"
                AutomationProperties.Name="Delete selected profile"
                ToolTipService.ToolTip="Permanently remove the selected profile."/>
      </WrapPanel>

    </StackPanel>
  </ScrollViewer>
</UserControl>
