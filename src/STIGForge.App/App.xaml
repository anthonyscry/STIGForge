<Application x:Class="STIGForge.App.App" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:local="clr-namespace:STIGForge.App" xmlns:converters="clr-namespace:STIGForge.App" ShutdownMode="OnMainWindowClose">
  <Application.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <!-- Default: Dark theme (swapped at runtime via ApplyTheme) -->
        <ResourceDictionary Source="Themes/DarkTheme.xaml"/>
      </ResourceDictionary.MergedDictionaries>

      <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
      <local:NullOrEmptyToCollapsedConverter x:Key="NullOrEmptyToCollapsed" />
      <local:BoolToPassFailConverter x:Key="BoolToPassFail" />
      <local:BoolToReadyVerdictConverter x:Key="BoolToReadyVerdict" />
      <local:BoolToReadyColorConverter x:Key="BoolToReadyColor" />
      <converters:StepFontWeightConverter x:Key="StepFontWeightConverter" />

      <!-- ═══════════ TEXT ═══════════ -->
      <Style TargetType="TextBlock">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <!-- ═══════════ BORDER ═══════════ -->
      <Style TargetType="Border">
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
      </Style>

      <!-- ═══════════ BUTTON ═══════════ -->
      <Style TargetType="Button">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Padding" Value="10,4" />
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="Button">
              <Border x:Name="ButtonBorder"
                      Background="{TemplateBinding Background}"
                      BorderBrush="{TemplateBinding BorderBrush}"
                      BorderThickness="{TemplateBinding BorderThickness}"
                      CornerRadius="7" SnapsToDevicePixels="True">
                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"
                                  Margin="{TemplateBinding Padding}" RecognizesAccessKey="True" />
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonHoverBrush}" />
                  <Setter TargetName="ButtonBorder" Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                  <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonPressedBrush}" />
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                  <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonDisabledBgBrush}" />
                  <Setter TargetName="ButtonBorder" Property="BorderBrush" Value="{DynamicResource ButtonDisabledBorderBrush}" />
                  <Setter Property="Foreground" Value="{DynamicResource ButtonDisabledFgBrush}" />
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <!-- ═══════════ TEXTBOX ═══════════ -->
      <Style TargetType="TextBox">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="8,4" />
        <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}" />
        <Setter Property="SelectionBrush" Value="{DynamicResource AccentSoftBrush}" />
      </Style>

      <!-- ═══════════ COMBOBOX ═══════════ -->
      <Style TargetType="ComboBox">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        <Setter Property="Background" Value="{DynamicResource ComboBoxBgBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="8,4" />
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="ComboBox">
              <Grid>
                <ToggleButton x:Name="ToggleButton" ClickMode="Press" Focusable="False"
                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                  <ToggleButton.Template>
                    <ControlTemplate TargetType="ToggleButton">
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition/>
                          <ColumnDefinition Width="24"/>
                        </Grid.ColumnDefinitions>
                        <Border x:Name="Border" Grid.ColumnSpan="2" CornerRadius="4"
                                Background="{DynamicResource ComboBoxBgBrush}"
                                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"/>
                        <Path x:Name="Arrow" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                              Data="M0,0 L4,4 8,0" Stroke="{DynamicResource ComboBoxArrowBrush}" StrokeThickness="1.5"
                              Fill="Transparent"/>
                      </Grid>
                      <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                          <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                        </Trigger>
                      </ControlTemplate.Triggers>
                    </ControlTemplate>
                  </ToggleButton.Template>
                </ToggleButton>
                <ContentPresenter x:Name="ContentSite" IsHitTestVisible="False"
                                  Content="{TemplateBinding SelectionBoxItem}"
                                  ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                  ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                  Margin="8,4,28,4" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                <TextBox x:Name="PART_EditableTextBox" Visibility="Hidden" IsReadOnly="{TemplateBinding IsReadOnly}"
                         Background="Transparent" Foreground="{DynamicResource TextPrimaryBrush}"
                         CaretBrush="{DynamicResource TextPrimaryBrush}"
                         HorizontalAlignment="Left" VerticalAlignment="Center" Margin="8,4,28,4" Focusable="True">
                  <TextBox.Template>
                    <ControlTemplate TargetType="TextBox">
                      <Border x:Name="PART_ContentHost" Focusable="False" Background="Transparent"/>
                    </ControlTemplate>
                  </TextBox.Template>
                </TextBox>
                <Popup x:Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}"
                       AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                  <Grid x:Name="DropDown" SnapsToDevicePixels="True"
                        MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                    <Border x:Name="DropDownBorder" CornerRadius="4"
                            Background="{DynamicResource ComboBoxPopupBgBrush}"
                            BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"/>
                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                      <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                    </ScrollViewer>
                  </Grid>
                </Popup>
              </Grid>
              <ControlTemplate.Triggers>
                <Trigger Property="IsEditable" Value="True">
                  <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                  <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style TargetType="ComboBoxItem">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Padding" Value="8,5"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="ComboBoxItem">
              <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}"
                      CornerRadius="3" SnapsToDevicePixels="True">
                <ContentPresenter/>
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ComboBoxItemHoverBrush}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentSoftBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <!-- ═══════════ TABCONTROL ═══════════ -->
      <Style TargetType="TabControl">
        <Setter Property="Background" Value="{DynamicResource TabPanelBgBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="4"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="TabControl">
              <Grid KeyboardNavigation.TabNavigation="Local" SnapsToDevicePixels="True">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="{DynamicResource SurfaceMutedBrush}" CornerRadius="8,8,0,0"
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="4,4,4,0">
                  <TabPanel x:Name="HeaderPanel" IsItemsHost="True" KeyboardNavigation.TabIndex="1"
                            Background="Transparent"/>
                </Border>
                <Border Grid.Row="1" Background="{DynamicResource TabPanelBgBrush}" CornerRadius="0,0,8,8"
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1,0,1,1">
                  <ContentPresenter x:Name="PART_SelectedContentHost" ContentSource="SelectedContent"
                                    Margin="{TemplateBinding Padding}"/>
                </Border>
              </Grid>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style TargetType="TabItem">
        <Setter Property="Padding" Value="14,8" />
        <Setter Property="Margin" Value="0,0,4,0" />
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}" />
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="TabItem">
              <Border x:Name="TabBorder" Background="{DynamicResource TabBgBrush}"
                      CornerRadius="6,6,0,0" Padding="{TemplateBinding Padding}"
                      BorderBrush="Transparent" BorderThickness="1,1,1,0"
                      SnapsToDevicePixels="True" Margin="{TemplateBinding Margin}">
                <ContentPresenter x:Name="ContentSite" ContentSource="Header" HorizontalAlignment="Center"
                                  VerticalAlignment="Center" RecognizesAccessKey="True"/>
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource TabHoverBgBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                  <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource TabSelectedBgBrush}"/>
                  <Setter TargetName="TabBorder" Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <!-- ═══════════ LISTVIEW / LISTVIEWITEM ═══════════ -->
      <Style TargetType="ListView">
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <Style TargetType="ListViewItem">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Padding" Value="4,3"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="ListViewItem">
              <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}"
                      CornerRadius="3" SnapsToDevicePixels="True" BorderBrush="Transparent" BorderThickness="0">
                <GridViewRowPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                      Columns="{Binding Path=View.Columns, RelativeSource={RelativeSource AncestorType=ListView}}"/>
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ListItemHoverBrush}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ListItemSelectedBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource ListItemSelectedTextBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style TargetType="ListBox">
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <Style TargetType="ListBoxItem">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Padding" Value="6,4"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="ListBoxItem">
              <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}"
                      CornerRadius="3" SnapsToDevicePixels="True">
                <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center"/>
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ListItemHoverBrush}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ListItemSelectedBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource ListItemSelectedTextBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style TargetType="DataGrid">
        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="RowBackground" Value="{DynamicResource SurfaceBrush}"/>
        <Setter Property="AlternatingRowBackground" Value="{DynamicResource SurfaceMutedBrush}"/>
        <Setter Property="GridLinesVisibility" Value="Horizontal"/>
      </Style>

      <Style TargetType="GridViewColumnHeader">
        <Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}"/>
        <Setter Property="Background" Value="{DynamicResource GridViewHeaderBgBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource GridViewHeaderBorderBrush}"/>
        <Setter Property="Padding" Value="8,5"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="GridViewColumnHeader">
              <Grid>
                <Border x:Name="HeaderBorder" Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="0,0,1,1"
                        Padding="{TemplateBinding Padding}" CornerRadius="0">
                  <ContentPresenter x:Name="HeaderContent"
                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                </Border>
                <Thumb x:Name="PART_HeaderGripper" HorizontalAlignment="Right" Width="4" Margin="0,0,-2,0"
                       Background="Transparent" Cursor="SizeWE">
                  <Thumb.Template>
                    <ControlTemplate TargetType="Thumb">
                      <Border Background="Transparent" Width="4"/>
                    </ControlTemplate>
                  </Thumb.Template>
                </Thumb>
              </Grid>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource ListItemHoverBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <!-- ═══════════ SCROLLBAR ═══════════ -->
      <Style x:Key="ScrollBarThumb" TargetType="Thumb">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="OverridesDefaultStyle" Value="True"/>
        <Setter Property="IsTabStop" Value="False"/>
        <Setter Property="Focusable" Value="False"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="Thumb">
              <Border x:Name="ThumbBorder" CornerRadius="4" Background="{DynamicResource ScrollThumbBrush}"/>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="ThumbBorder" Property="Background" Value="{DynamicResource ScrollThumbHoverBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style x:Key="ScrollBarLineButton" TargetType="RepeatButton">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="OverridesDefaultStyle" Value="True"/>
        <Setter Property="Focusable" Value="False"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="RepeatButton">
              <Border x:Name="Bd" Background="Transparent" CornerRadius="3">
                <Path x:Name="Arrow" HorizontalAlignment="Center" VerticalAlignment="Center"
                      Data="{Binding Content, RelativeSource={RelativeSource TemplatedParent}}"
                      Fill="{DynamicResource ScrollArrowBrush}" />
              </Border>
              <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ScrollThumbBrush}"/>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style x:Key="ScrollBarPageButton" TargetType="RepeatButton">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="OverridesDefaultStyle" Value="True"/>
        <Setter Property="IsTabStop" Value="False"/>
        <Setter Property="Focusable" Value="False"/>
        <Setter Property="Template">
          <Setter.Value>
            <ControlTemplate TargetType="RepeatButton">
              <Border Background="Transparent"/>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>

      <Style TargetType="ScrollBar">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="OverridesDefaultStyle" Value="True"/>
        <Style.Triggers>
          <Trigger Property="Orientation" Value="Vertical">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="Auto"/>
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="ScrollBar">
                  <Grid Background="{DynamicResource ScrollTrackBrush}">
                    <Grid.RowDefinitions>
                      <RowDefinition MaxHeight="14"/>
                      <RowDefinition Height="0.00001*"/>
                      <RowDefinition MaxHeight="14"/>
                    </Grid.RowDefinitions>
                    <RepeatButton Grid.Row="0" Style="{StaticResource ScrollBarLineButton}" Command="ScrollBar.LineUpCommand"
                                  Content="M 0 4 L 4 0 L 8 4 Z"/>
                    <Track x:Name="PART_Track" Grid.Row="1" IsDirectionReversed="True">
                      <Track.DecreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageUpCommand"/>
                      </Track.DecreaseRepeatButton>
                      <Track.Thumb>
                        <Thumb Style="{StaticResource ScrollBarThumb}" Margin="1,0"/>
                      </Track.Thumb>
                      <Track.IncreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageDownCommand"/>
                      </Track.IncreaseRepeatButton>
                    </Track>
                    <RepeatButton Grid.Row="2" Style="{StaticResource ScrollBarLineButton}" Command="ScrollBar.LineDownCommand"
                                  Content="M 0 0 L 4 4 L 8 0 Z"/>
                  </Grid>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Trigger>
          <Trigger Property="Orientation" Value="Horizontal">
            <Setter Property="Height" Value="10"/>
            <Setter Property="Width" Value="Auto"/>
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="ScrollBar">
                  <Grid Background="{DynamicResource ScrollTrackBrush}">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition MaxWidth="14"/>
                      <ColumnDefinition Width="0.00001*"/>
                      <ColumnDefinition MaxWidth="14"/>
                    </Grid.ColumnDefinitions>
                    <RepeatButton Grid.Column="0" Style="{StaticResource ScrollBarLineButton}" Command="ScrollBar.LineLeftCommand"
                                  Content="M 4 0 L 0 4 L 4 8 Z"/>
                    <Track x:Name="PART_Track" Grid.Column="1" IsDirectionReversed="False">
                      <Track.DecreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageLeftCommand"/>
                      </Track.DecreaseRepeatButton>
                      <Track.Thumb>
                        <Thumb Style="{StaticResource ScrollBarThumb}" Margin="0,1"/>
                      </Track.Thumb>
                      <Track.IncreaseRepeatButton>
                        <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageRightCommand"/>
                      </Track.IncreaseRepeatButton>
                    </Track>
                    <RepeatButton Grid.Column="2" Style="{StaticResource ScrollBarLineButton}" Command="ScrollBar.LineRightCommand"
                                  Content="M 0 0 L 4 4 L 0 8 Z"/>
                  </Grid>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Trigger>
        </Style.Triggers>
      </Style>

      <!-- ═══════════ CHECKBOX ═══════════ -->
      <Style TargetType="CheckBox">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <!-- ═══════════ RADIOBUTTON ═══════════ -->
      <Style TargetType="RadioButton">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <!-- ═══════════ SEPARATOR ═══════════ -->
      <Style TargetType="Separator">
        <Setter Property="Background" Value="{DynamicResource BorderBrush}" />
      </Style>

      <!-- ═══════════ PROGRESSBAR ═══════════ -->
      <Style TargetType="ProgressBar">
        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
        <Setter Property="Background" Value="{DynamicResource SurfaceMutedBrush}" />
      </Style>

      <!-- ═══════════ EXPANDER ═══════════ -->
      <Style TargetType="Expander">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <!-- ═══════════ SCROLLVIEWER ═══════════ -->
      <Style TargetType="ScrollViewer">
        <Setter Property="Background" Value="Transparent" />
      </Style>

      <!-- ═══════════ TOOLTIP ═══════════ -->
      <Style TargetType="ToolTip">
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        <Setter Property="Background" Value="{DynamicResource ToolTipBgBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource ToolTipBorderBrush}" />
        <Setter Property="Padding" Value="8,5"/>
      </Style>

      <!-- ═══════════ WINDOW ═══════════ -->
      <Style TargetType="Window">
        <Setter Property="FontFamily" Value="Segoe UI" />
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
      </Style>

      <!-- ═══════════ SETUP STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="SetupStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 1: Setup" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Configure paths for the workflow. Paths will be auto-detected where possible." 
                     Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,0,20"/>

          <TextBlock Text="Import Folder" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <Grid Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Text="{Binding ImportFolderPath, UpdateSourceTrigger=PropertyChanged}" Height="32" VerticalContentAlignment="Center"/>
            <Button Grid.Column="1" Content="Browse..." Width="80" Height="32" Margin="8,0,0,0" Command="{Binding BrowseImportFolderCommand}"/>
          </Grid>

          <TextBlock Text="Evaluate-STIG Tool Path" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <Grid Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Text="{Binding EvaluateStigToolPath, UpdateSourceTrigger=PropertyChanged}" Height="32" VerticalContentAlignment="Center"/>
            <Button Grid.Column="1" Content="Browse..." Width="80" Height="32" Margin="8,0,0,0" Command="{Binding BrowseEvaluateStigCommand}"/>
          </Grid>

          <TextBlock Text="SCC Tool Path (Optional)" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <Grid Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Text="{Binding SccToolPath, UpdateSourceTrigger=PropertyChanged}" Height="32" VerticalContentAlignment="Center"/>
            <Button Grid.Column="1" Content="Browse..." Width="80" Height="32" Margin="8,0,0,0" Command="{Binding BrowseSccCommand}"/>
          </Grid>

          <TextBlock Text="Output Folder" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <Grid Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Text="{Binding OutputFolderPath, UpdateSourceTrigger=PropertyChanged}" Height="32" VerticalContentAlignment="Center"/>
            <Button Grid.Column="1" Content="Browse..." Width="80" Height="32" Margin="8,0,0,0" Command="{Binding BrowseOutputFolderCommand}"/>
          </Grid>

          <TextBlock Text="Machine Target" FontWeight="SemiBold" Margin="0,0,0,4"/>
          <TextBox Text="{Binding MachineTarget, UpdateSourceTrigger=PropertyChanged}" Height="32" Width="300" HorizontalAlignment="Left" VerticalContentAlignment="Center"/>
          <TextBlock Text="Use 'localhost' for local machine or enter a remote hostname" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,0"/>
        </StackPanel>
      </DataTemplate>

      <!-- ═══════════ IMPORT STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="ImportStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 2: Import" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Importing STIG content from the import folder..." Margin="0,0,0,20"/>
          <ProgressBar Height="20" IsIndeterminate="{Binding IsBusy}" Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}"/>
          <TextBlock Text="{Binding StatusText}" Margin="0,10,0,0"/>
        </StackPanel>
      </DataTemplate>

      <!-- ═══════════ SCAN STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="ScanStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 3: Scan" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Running Evaluate-STIG to establish baseline findings..." Margin="0,0,0,20"/>
          <ProgressBar Height="20" IsIndeterminate="{Binding IsBusy}" Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}"/>
          <TextBlock Text="{Binding StatusText}" Margin="0,10,0,0"/>
        </StackPanel>
      </DataTemplate>

      <!-- ═══════════ HARDEN STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="HardenStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 4: Harden" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Applying PowerSTIG/DSC configurations, GPO settings, and ADMX templates..." Margin="0,0,0,20"/>
          <ProgressBar Height="20" IsIndeterminate="{Binding IsBusy}" Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}"/>
          <TextBlock Text="{Binding StatusText}" Margin="0,10,0,0"/>
        </StackPanel>
      </DataTemplate>

      <!-- ═══════════ VERIFY STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="VerifyStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 5: Verify" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Re-running Evaluate-STIG and SCC to verify hardening results..." Margin="0,0,0,20"/>
          <ProgressBar Height="20" IsIndeterminate="{Binding IsBusy}" Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}"/>
          <TextBlock Text="{Binding StatusText}" Margin="0,10,0,0"/>
        </StackPanel>
      </DataTemplate>

      <!-- ═══════════ DONE STEP TEMPLATE ═══════════ -->
      <DataTemplate x:Key="DoneStepTemplate">
        <StackPanel MaxWidth="600">
          <TextBlock Text="Step 6: Done" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>
          <TextBlock Text="Workflow completed!" FontSize="18" Foreground="Green" Margin="0,0,0,20"/>

          <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Padding="16" Margin="0,0,0,20">
            <StackPanel>
              <TextBlock Text="Summary" FontWeight="SemiBold" Margin="0,0,0,10"/>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="200"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                  <RowDefinition/>
                  <RowDefinition/>
                  <RowDefinition/>
                  <RowDefinition/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Baseline Findings:"/>
                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding BaselineFindingsCount}" FontWeight="SemiBold"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Fixed:"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FixedCount}" FontWeight="SemiBold" Foreground="Green"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Remaining Findings:"/>
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding VerifyFindingsCount}" FontWeight="SemiBold"/>

                <TextBlock Grid.Row="3" Grid.Column="0" Text="Content Packs Imported:"/>
                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding ImportedItemsCount}" FontWeight="SemiBold"/>
              </Grid>
            </StackPanel>
          </Border>

          <TextBlock Text="Mission JSON:" FontWeight="SemiBold"/>
          <TextBox Text="{Binding MissionJsonPath, Mode=OneWay}" IsReadOnly="True" Margin="0,4,0,16"/>

          <StackPanel Orientation="Horizontal">
            <Button Content="Open Output Folder" Width="150" Height="36" Margin="0,0,10,0" Command="{Binding OpenOutputFolderCommand}"/>
            <Button Content="Start New Workflow" Width="150" Height="36" Command="{Binding RestartWorkflowCommand}"/>
          </StackPanel>
        </StackPanel>
      </DataTemplate>

    </ResourceDictionary>
  </Application.Resources>
</Application>
