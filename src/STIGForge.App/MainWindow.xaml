<Window x:Class="STIGForge.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="STIGForge" Height="720" Width="1200" WindowStartupLocation="CenterScreen">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
  </Window.Resources>
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,8">
      <TextBlock Text="STIGForge" FontSize="22" FontWeight="SemiBold" />
      <Button Content="About" Width="60" Height="24" Margin="12,4,0,0" Command="{Binding ShowAboutCommand}" DockPanel.Dock="Right"/>
      <TextBlock Text="{Binding StatusText}" Margin="12,8,0,0" Foreground="Gray"/>
      <ProgressBar Width="120" Height="12" Margin="12,10,0,0" IsIndeterminate="True"
                   Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}" />
    </DockPanel>

    <TabControl Grid.Row="1">
      <TabItem Header="Dashboard">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Bundle Info -->
          <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Padding="16" Margin="0,0,0,16" Background="#FAFAFA">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <StackPanel Grid.Column="0">
                <TextBlock Text="Active Bundle" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Bundle:" FontWeight="SemiBold" Width="80"/>
                  <TextBlock Text="{Binding DashBundleLabel}" Foreground="Gray"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Pack:" FontWeight="SemiBold" Width="80"/>
                  <TextBlock Text="{Binding DashPackLabel}" Foreground="Gray"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Profile:" FontWeight="SemiBold" Width="80"/>
                  <TextBlock Text="{Binding DashProfileLabel}" Foreground="Gray"/>
                </StackPanel>
              </StackPanel>
              <Button Grid.Column="1" Content="Refresh" Width="80" Height="28" VerticalAlignment="Top"
                      Command="{Binding DashRefreshCommand}"/>
            </Grid>
          </Border>

          <!-- Stats Cards -->
          <Grid Grid.Row="1" Margin="0,0,0,16"
                Visibility="{Binding DashHasBundle, Converter={StaticResource BoolToVisibility}}">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="16"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Controls Card -->
            <Border Grid.Column="0" BorderBrush="LightGray" BorderThickness="1" Padding="16" Background="White">
              <StackPanel>
                <TextBlock Text="Controls" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding DashTotalControls}" FontSize="36" FontWeight="Bold" Foreground="#2196F3"/>
                <TextBlock Text="Total Controls" Foreground="Gray" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Automated:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashAutoControls}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Manual:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualControls}"/>
                </StackPanel>
              </StackPanel>
            </Border>

            <!-- Verify Card -->
            <Border Grid.Column="2" BorderBrush="LightGray" BorderThickness="1" Padding="16" Background="White">
              <StackPanel>
                <TextBlock Text="Automated Verification" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding DashVerifyPercent}" FontSize="36" FontWeight="Bold" Foreground="#4CAF50"/>
                <TextBlock Text="Compliance Rate" Foreground="Gray" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Closed:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashVerifyClosed}" Foreground="Green"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Open:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashVerifyOpen}" Foreground="Red"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Last run:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashLastVerify}" Foreground="Gray"/>
                </StackPanel>
              </StackPanel>
            </Border>

            <!-- Manual Card -->
            <Border Grid.Column="4" BorderBrush="LightGray" BorderThickness="1" Padding="16" Background="White">
              <StackPanel>
                <TextBlock Text="Manual Review" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding DashManualPercent}" FontSize="36" FontWeight="Bold" Foreground="#FF9800"/>
                <TextBlock Text="Answered Rate" Foreground="Gray" Margin="0,4,0,12"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Pass:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualPass}" Foreground="Green"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="Fail:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualFail}" Foreground="Red"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <TextBlock Text="N/A:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualNa}" Foreground="Gray"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="Open:" FontWeight="SemiBold" Width="90"/>
                  <TextBlock Text="{Binding DashManualOpen}" Foreground="Orange"/>
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>

          <!-- Quick Actions -->
          <Border Grid.Row="2" BorderBrush="LightGray" BorderThickness="1" Padding="16" Background="White"
                  Visibility="{Binding DashHasBundle, Converter={StaticResource BoolToVisibility}}">
            <StackPanel>
              <TextBlock Text="Quick Actions" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
              <StackPanel Orientation="Horizontal">
                <Button Content="Run Apply" Width="120" Height="32" Command="{Binding ApplyRunCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"/>
                <Button Content="Run Verify" Width="120" Height="32" Command="{Binding VerifyRunCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"/>
                <Button Content="Export eMASS" Width="120" Height="32" Command="{Binding ExportEmassCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"/>
                <Button Content="Launch Wizard" Width="120" Height="32" Command="{Binding LaunchManualWizardCommand}" IsEnabled="{Binding ActionsEnabled}" Margin="0,0,8,0"/>
                <Button Content="Compare Packs" Width="120" Height="32" Command="{Binding ComparePacksCommand}" Margin="0,0,8,0"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                <TextBlock Text="Last eMASS export:" Foreground="Gray" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding DashLastExport}" Foreground="Gray"/>
              </StackPanel>
              <TextBlock Text="{Binding DashMissionSeverity}" Margin="0,8,0,0" Foreground="Gray" TextWrapping="Wrap"/>
              <TextBlock Text="{Binding DashRecoveryGuidance}" Margin="0,4,0,0" Foreground="Gray" TextWrapping="Wrap"/>
            </StackPanel>
          </Border>
        </Grid>
      </TabItem>

      <TabItem Header="Content Packs">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Import ZIP..." Width="140" Command="{Binding ImportContentPackCommand}" />
            <Button Content="Compare Packs..." Width="140" Margin="8,0,0,0" Command="{Binding ComparePacksCommand}" />
            <TextBlock Text="{Binding ImportHint}" Margin="12,8,0,0" Foreground="Gray"/>
          </StackPanel>

          <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ListView Grid.Column="0" ItemsSource="{Binding ContentPacks}" SelectedItem="{Binding SelectedPack}">
              <ListView.View>
                <GridView>
                  <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="220"/>
                  <GridViewColumn Header="PackId" DisplayMemberBinding="{Binding PackId}" Width="260"/>
                  <GridViewColumn Header="ImportedAt" DisplayMemberBinding="{Binding ImportedAt}" Width="180"/>
                  <GridViewColumn Header="Source" DisplayMemberBinding="{Binding SourceLabel}" Width="220"/>
                </GridView>
              </ListView.View>
            </ListView>

            <StackPanel Grid.Column="1" Margin="12,0,0,0">
              <TextBlock Text="Pack Details" FontWeight="SemiBold" />
              <TextBlock Text="Name:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailName}" Foreground="Gray" />

              <TextBlock Text="PackId:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailId}" Foreground="Gray" />

              <TextBlock Text="Release date:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailReleaseDate}" Foreground="Gray" />

              <TextBlock Text="Imported:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailImportedAt}" Foreground="Gray" />

              <TextBlock Text="Source:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailSource}" Foreground="Gray" />

              <TextBlock Text="Hash:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailHash}" Foreground="Gray" TextWrapping="Wrap" />

              <TextBlock Text="Controls:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailControls}" Foreground="Gray" />

              <TextBlock Text="Root:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailRoot}" Foreground="Gray" TextWrapping="Wrap" />

              <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <Button Content="Open Pack" Width="120" Command="{Binding OpenPackFolderCommand}" />
                <Button Content="Export Map" Width="120" Margin="6,0,0,0" Command="{Binding ExportPowerStigMapCommand}" />
                <Button Content="Delete Pack" Width="100" Margin="6,0,0,0" Command="{Binding DeleteSelectedPackCommand}" Foreground="Red"/>
              </StackPanel>
            </StackPanel>
          </Grid>
        </Grid>
      </TabItem>

      <TabItem Header="Profiles">
        <Grid Margin="12">
          <StackPanel>
            <TextBlock Text="Profile Editor" FontWeight="SemiBold" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Profile:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,0,0" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}"
                        DisplayMemberPath="Name" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Name:" Width="80" VerticalAlignment="Center" />
              <TextBox Width="320" Text="{Binding ProfileName}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Mode:" Width="80" VerticalAlignment="Center" />
              <ComboBox Width="140" SelectedItem="{Binding ProfileMode}">
                <ComboBoxItem>AuditOnly</ComboBoxItem>
                <ComboBoxItem>Safe</ComboBoxItem>
                <ComboBoxItem>Full</ComboBoxItem>
              </ComboBox>

              <TextBlock Text="Class:" Width="80" Margin="20,0,0,0" VerticalAlignment="Center" />
              <ComboBox Width="160" SelectedItem="{Binding ProfileClassification}">
                <ComboBoxItem>Classified</ComboBoxItem>
                <ComboBoxItem>Unclassified</ComboBoxItem>
                <ComboBoxItem>Mixed</ComboBoxItem>
              </ComboBox>
            </StackPanel>

            <CheckBox Content="Auto-NA out-of-scope controls" Margin="0,8,0,0" IsChecked="{Binding ProfileAutoNa}" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Grace days:" Width="80" VerticalAlignment="Center" />
              <TextBox Width="80" Text="{Binding ProfileGraceDays}" />
            </StackPanel>

            <TextBlock Text="NA comment" Margin="0,8,0,0" />
            <TextBox Height="60" TextWrapping="Wrap" Text="{Binding ProfileNaComment}" />

            <TextBlock Text="Overlays" Margin="0,8,0,0" />
            <ItemsControl ItemsSource="{Binding OverlayItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <CheckBox Content="{Binding Overlay.Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <Button Content="Edit Overlays" Width="120" Command="{Binding OpenOverlayEditorCommand}" />
              <Button Content="Rebase Overlay" Width="120" Margin="6,0,0,0" Command="{Binding RebaseOverlayCommand}" />
              <Button Content="Refresh" Width="90" Margin="6,0,0,0" Command="{Binding RefreshOverlaysCommand}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
              <Button Content="Save Profile" Width="120" Command="{Binding SaveProfileCommand}" />
              <Button Content="Delete Profile" Width="110" Margin="6,0,0,0" Command="{Binding DeleteSelectedProfileCommand}" Foreground="Red"/>
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Build">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Pack:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,18,0" ItemsSource="{Binding ContentPacks}" SelectedItem="{Binding SelectedPack}"
                        DisplayMemberPath="Name" />
              <TextBlock Text="Profile:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,0,0" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}"
                        DisplayMemberPath="Name" />
            </StackPanel>
            <Button Content="Build Bundle" Width="140" Command="{Binding BuildBundleCommand}" IsEnabled="{Binding ActionsEnabled}" />
            <TextBlock Text="Build uses release-age automation gate; see Reports/automation_gate.json in the bundle."
                       Margin="0,8,0,0" TextWrapping="Wrap" />
            <TextBlock Text="{Binding BuildGateStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <Button Content="Open Gate" Width="100" Command="{Binding OpenAutomationGateCommand}" IsEnabled="{Binding ActionsEnabled}" />
              <TextBlock Text=" {Binding AutomationGatePath}" Foreground="Gray" Margin="6,0,0,0" />
            </StackPanel>

            <TextBlock Text="Recent Bundles" Margin="0,10,0,0" />
            <StackPanel Orientation="Horizontal">
              <ComboBox Width="520" ItemsSource="{Binding RecentBundles}" SelectedItem="{Binding SelectedRecentBundle}" />
              <Button Content="Use" Width="80" Margin="6,0,0,0" Command="{Binding UseRecentBundleCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Apply">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <Button Content="Run Apply" Width="140" Command="{Binding ApplyRunCommand}" />
            <TextBlock Text="Applies using bundle Apply/RunApply.ps1" Margin="0,8,0,0" />
            <TextBlock Text="{Binding ApplyStatus}" Margin="0,6,0,0" Foreground="Gray" TextWrapping="Wrap" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Verify">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Eval-STIG Root:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding EvaluateStigRoot}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseEvaluateStigCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Eval Args:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding EvaluateStigArgs}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Cmd:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding ScapCommandPath}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseScapCommandCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Args:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding ScapArgs}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Label:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="200" Text="{Binding ScapLabel}" />
            </StackPanel>
            <Button Content="Run Verify" Width="140" Command="{Binding VerifyRunCommand}" IsEnabled="{Binding ActionsEnabled}" />
            <TextBlock Text="Runs Evaluate-STIG / SCAP if configured" Margin="0,8,0,0" />
            <TextBlock Text="{Binding VerifyStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <TextBlock Text="{Binding VerifySummary}" Margin="0,6,0,0" Foreground="Gray" TextWrapping="Wrap" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
            <Button Content="Refresh Overlap" Width="140" Margin="0,8,0,0" Command="{Binding RefreshOverlapCommand}" />
            <ListView ItemsSource="{Binding OverlapItems}" Height="160" Margin="0,6,0,0">
              <ListView.View>
                <GridView>
                  <GridViewColumn Header="Sources" DisplayMemberBinding="{Binding SourcesKey}" Width="220" />
                  <GridViewColumn Header="#" DisplayMemberBinding="{Binding SourceCount}" Width="40" />
                  <GridViewColumn Header="Controls" DisplayMemberBinding="{Binding ControlsCount}" Width="70" />
                  <GridViewColumn Header="Closed" DisplayMemberBinding="{Binding ClosedCount}" Width="60" />
                  <GridViewColumn Header="Open" DisplayMemberBinding="{Binding OpenCount}" Width="60" />
                </GridView>
              </ListView.View>
            </ListView>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Evidence">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="RuleId:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="260" Text="{Binding EvidenceRuleId}" />
              <TextBlock Text="Type:" Width="60" Margin="12,0,0,0" VerticalAlignment="Center" />
              <ComboBox Width="160" ItemsSource="{Binding EvidenceTypes}" SelectedItem="{Binding EvidenceType}" />
            </StackPanel>

            <TextBlock Text="Evidence text" />
            <TextBox Height="80" TextWrapping="Wrap" Text="{Binding EvidenceText}" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="File:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="420" Text="{Binding EvidenceFilePath}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseEvidenceFileCommand}" />
            </StackPanel>

            <Button Content="Save Evidence" Width="140" Margin="0,8,0,0" Command="{Binding SaveEvidenceCommand}" />
            <TextBlock Text="{Binding EvidenceStatus}" Margin="0,6,0,0" Foreground="Gray" />
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Manual">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Launch Review Wizard" Width="160" Command="{Binding LaunchManualWizardCommand}" 
                    IsEnabled="{Binding ActionsEnabled}"/>
            <TextBlock Text="Step-by-step wizard for reviewing manual controls with guided workflow" 
                       Margin="12,8,0,0" Foreground="Gray"/>
          </StackPanel>

          <!-- Filter Controls -->
          <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <TextBox Width="240" Text="{Binding ManualFilterText, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock Text="Status:" VerticalAlignment="Center" Margin="16,0,6,0"/>
            <ComboBox Width="140" ItemsSource="{Binding ManualStatusFilters}" SelectedItem="{Binding ManualStatusFilter}" />
          </StackPanel>

          <!-- Summary Bar -->
          <TextBlock Grid.Row="2" Text="{Binding ManualSummary}" Foreground="Gray" Margin="0,0,0,8"/>

          <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <ListView Grid.Column="0" ItemsSource="{Binding ManualControlsView}" SelectedItem="{Binding SelectedManualControl}">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="RuleId" DisplayMemberBinding="{Binding Control.ExternalIds.RuleId}" Width="140" />
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Control.Title}" Width="220" />
                <GridViewColumn Header="Status" DisplayMemberBinding="{Binding Status}" Width="80" />
              </GridView>
            </ListView.View>
          </ListView>

          <StackPanel Grid.Column="1" Margin="12,0,0,0">
            <TextBlock Text="Selected Control" FontWeight="SemiBold" />
            <TextBlock Text="{Binding SelectedManualControl.Control.Title}" TextWrapping="Wrap" Margin="0,6,0,0" />
            <TextBlock Text="{Binding SelectedManualControl.Control.CheckText}" TextWrapping="Wrap" Margin="0,6,0,0" Foreground="Gray" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Status:" Width="60" VerticalAlignment="Center" />
              <ComboBox Width="160" ItemsSource="{Binding ManualStatuses}" SelectedItem="{Binding ManualStatus}" />
            </StackPanel>

            <TextBlock Text="Reason" Margin="0,8,0,0" />
            <TextBox Text="{Binding ManualReason}" Height="40" TextWrapping="Wrap" />

            <TextBlock Text="Comment" Margin="0,8,0,0" />
            <TextBox Text="{Binding ManualComment}" Height="80" TextWrapping="Wrap" />

            <Button Content="Save Answer" Width="120" Margin="0,8,0,0" Command="{Binding SaveManualAnswerCommand}" />
            <TextBlock Text="Fail and NotApplicable require a reason." Foreground="Gray" Margin="0,4,0,0" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <Button Content="Use for Evidence" Width="130" Command="{Binding UseSelectedControlForEvidenceCommand}" />
              <Button Content="Collect Evidence" Width="130" Margin="8,0,0,0" Command="{Binding CollectSelectedControlEvidenceCommand}" />
              <Button Content="Open Evidence Folder" Width="150" Margin="8,0,0,0" Command="{Binding OpenSelectedControlEvidenceFolderCommand}" />
            </StackPanel>
            </StackPanel>
          </Grid>
        </Grid>
      </TabItem>

      <TabItem Header="Orchestrate">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Grid.Row="0" Text="One-Click Workflow: Apply → Verify → Export"
                     FontSize="16" FontWeight="SemiBold" Margin="0,0,0,16"/>

          <!-- Configuration -->
          <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Padding="16" Margin="0,0,0,16" Background="#FAFAFA">
            <StackPanel>
              <TextBlock Text="Configuration" FontWeight="SemiBold" Margin="0,0,0,12"/>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Bundle:" Width="120" VerticalAlignment="Center" />
                <TextBox Width="520" Text="{Binding BundleRoot}" />
                <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseBundleCommand}" />
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Eval-STIG Root:" Width="120" VerticalAlignment="Center" />
                <TextBox Width="520" Text="{Binding EvaluateStigRoot}" />
                <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseEvaluateStigCommand}" />
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="SCAP Cmd:" Width="120" VerticalAlignment="Center" />
                <TextBox Width="520" Text="{Binding ScapCommandPath}" />
                <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseScapCommandCommand}" />
              </StackPanel>

              <StackPanel Orientation="Horizontal">
                <CheckBox Content="Run Apply" IsChecked="{Binding OrchRunApply}" Margin="0,0,16,0"/>
                <CheckBox Content="Run Verify" IsChecked="{Binding OrchRunVerify}" Margin="0,0,16,0"/>
                <CheckBox Content="Export eMASS" IsChecked="{Binding OrchRunExport}" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Run + Log -->
          <Grid Grid.Row="2">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
              <Button Content="Run Orchestration" Width="160" Height="36" FontWeight="SemiBold"
                      Command="{Binding OrchestrateCommand}" IsEnabled="{Binding ActionsEnabled}" />
              <TextBlock Text="{Binding OrchStatus}" Margin="12,8,0,0" Foreground="Gray"/>
            </StackPanel>

            <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White">
              <ScrollViewer VerticalScrollBarVisibility="Auto">
                <TextBlock Text="{Binding OrchLog}" FontFamily="Consolas" FontSize="11" Padding="8"
                           TextWrapping="Wrap"/>
              </ScrollViewer>
            </Border>
          </Grid>
        </Grid>
      </TabItem>

      <TabItem Header="Reports">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <TextBlock Text="Recent Bundles" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <ComboBox Width="520" ItemsSource="{Binding RecentBundles}" SelectedItem="{Binding SelectedRecentBundle}" />
              <Button Content="Use" Width="80" Margin="6,0,0,0" Command="{Binding UseRecentBundleCommand}" />
            </StackPanel>
            <Button Content="Export eMASS" Width="140" Command="{Binding ExportEmassCommand}" IsEnabled="{Binding ActionsEnabled}" />
            <TextBlock Text="Exports eMASS package from bundle" Margin="0,8,0,0" />
            <TextBlock Text="{Binding ExportStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <TextBlock Text="{Binding ReportSummary}" Margin="0,6,0,0" Foreground="Gray" TextWrapping="Wrap" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Audit Log">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="Action:" Width="60" VerticalAlignment="Center"/>
            <TextBox Width="160" Text="{Binding AuditActionFilter}"/>
            <TextBlock Text="Target:" Width="60" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="200" Text="{Binding AuditTargetFilter}"/>
            <TextBlock Text="Limit:" Width="50" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="60" Text="{Binding AuditLimit}"/>
            <Button Content="Query" Width="80" Margin="12,0,0,0" Command="{Binding AuditQueryCommand}" IsEnabled="{Binding ActionsEnabled}"/>
            <Button Content="Verify Integrity" Width="120" Margin="8,0,0,0" Command="{Binding AuditVerifyCommand}" IsEnabled="{Binding ActionsEnabled}"/>
          </StackPanel>

          <TextBlock Grid.Row="1" Text="{Binding AuditVerifyResult}" Margin="0,0,0,8" FontWeight="SemiBold"/>

          <ListView Grid.Row="2" ItemsSource="{Binding AuditEntries}">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="50"/>
                <GridViewColumn Header="Timestamp" DisplayMemberBinding="{Binding Timestamp}" Width="160"/>
                <GridViewColumn Header="Action" DisplayMemberBinding="{Binding Action}" Width="100"/>
                <GridViewColumn Header="Target" DisplayMemberBinding="{Binding Target}" Width="200"/>
                <GridViewColumn Header="Result" DisplayMemberBinding="{Binding Result}" Width="80"/>
                <GridViewColumn Header="User" DisplayMemberBinding="{Binding User}" Width="100"/>
                <GridViewColumn Header="Detail" DisplayMemberBinding="{Binding Detail}" Width="300"/>
              </GridView>
            </ListView.View>
          </ListView>
        </Grid>
      </TabItem>

      <TabItem Header="Export">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <!-- POA&M Export -->
          <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Padding="16" Margin="0,0,0,16" Background="#FAFAFA">
            <StackPanel>
              <TextBlock Text="POA&amp;M Export" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="System Name:" Width="100" VerticalAlignment="Center"/>
                <TextBox Width="300" Text="{Binding PoamSystemName}"/>
              </StackPanel>
              <Button Content="Export POA&amp;M" Width="140" Command="{Binding ExportPoamCommand}" IsEnabled="{Binding ActionsEnabled}"/>
              <TextBlock Text="{Binding PoamStatus}" Margin="0,8,0,0" Foreground="Gray"/>
            </StackPanel>
          </Border>

          <!-- CKL Export -->
          <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Padding="16" Background="#FAFAFA">
            <StackPanel>
              <TextBlock Text="CKL (Checklist) Export" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Host Name:" Width="100" VerticalAlignment="Center"/>
                <TextBox Width="200" Text="{Binding CklHostName}"/>
                <TextBlock Text="STIG ID:" Width="70" Margin="12,0,0,0" VerticalAlignment="Center"/>
                <TextBox Width="200" Text="{Binding CklStigId}"/>
              </StackPanel>
              <Button Content="Export CKL" Width="140" Command="{Binding ExportCklCommand}" IsEnabled="{Binding ActionsEnabled}"/>
              <TextBlock Text="{Binding CklStatus}" Margin="0,8,0,0" Foreground="Gray"/>
            </StackPanel>
          </Border>
        </Grid>
      </TabItem>

      <TabItem Header="Schedule">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Padding="16" Margin="0,0,0,16" Background="#FAFAFA">
            <StackPanel>
              <TextBlock Text="Scheduled Re-Verification" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Task Name:" Width="90" VerticalAlignment="Center"/>
                <TextBox Width="240" Text="{Binding SchedTaskName}"/>
                <TextBlock Text="Frequency:" Width="80" Margin="12,0,0,0" VerticalAlignment="Center"/>
                <ComboBox Width="120" ItemsSource="{Binding ScheduleFrequencies}" SelectedItem="{Binding SchedFrequency}"/>
                <TextBlock Text="Time:" Width="50" Margin="12,0,0,0" VerticalAlignment="Center"/>
                <TextBox Width="80" Text="{Binding SchedTime}"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Register Task" Width="120" Command="{Binding ScheduleRegisterCommand}" IsEnabled="{Binding ActionsEnabled}"/>
                <Button Content="Remove Task" Width="120" Margin="8,0,0,0" Command="{Binding ScheduleRemoveCommand}" IsEnabled="{Binding ActionsEnabled}"/>
                <Button Content="Refresh" Width="80" Margin="8,0,0,0" Command="{Binding ScheduleRefreshCommand}"/>
              </StackPanel>
              <TextBlock Text="{Binding SchedStatus}" Foreground="Gray"/>
            </StackPanel>
          </Border>

          <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <TextBlock Text="{Binding SchedListOutput}" FontFamily="Consolas" FontSize="11" Padding="8" TextWrapping="Wrap"/>
            </ScrollViewer>
          </Border>
        </Grid>
      </TabItem>

      <TabItem Header="Fleet">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Padding="16" Margin="0,0,0,16" Background="#FAFAFA">
            <StackPanel>
              <TextBlock Text="Fleet Operations (WinRM)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Targets:" Width="80" VerticalAlignment="Center"/>
                <TextBox Width="600" Text="{Binding FleetTargets}" ToolTip="Comma-separated: host1,host2:ip,host3"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Operation:" Width="80" VerticalAlignment="Center"/>
                <ComboBox Width="120" ItemsSource="{Binding FleetOperations}" SelectedItem="{Binding FleetOperation}"/>
                <TextBlock Text="Concurrency:" Width="90" Margin="12,0,0,0" VerticalAlignment="Center"/>
                <TextBox Width="60" Text="{Binding FleetConcurrency}"/>
                <TextBlock Text="Timeout:" Width="70" Margin="12,0,0,0" VerticalAlignment="Center"/>
                <TextBox Width="60" Text="{Binding FleetTimeout}"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Execute" Width="100" Height="32" FontWeight="SemiBold"
                        Command="{Binding FleetExecuteCommand}" IsEnabled="{Binding ActionsEnabled}"/>
                <Button Content="Check Status" Width="120" Height="32" Margin="8,0,0,0"
                        Command="{Binding FleetCheckStatusCommand}" IsEnabled="{Binding ActionsEnabled}"/>
                <TextBlock Text="{Binding FleetStatus}" Margin="12,8,0,0" Foreground="Gray"/>
              </StackPanel>
            </StackPanel>
          </Border>

          <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <TextBlock Text="{Binding FleetLog}" FontFamily="Consolas" FontSize="11" Padding="8" TextWrapping="Wrap"/>
            </ScrollViewer>
          </Border>
        </Grid>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
