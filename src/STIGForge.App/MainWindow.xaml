<Window x:Class="STIGForge.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="STIGForge" Height="720" Width="1200" WindowStartupLocation="CenterScreen">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
  </Window.Resources>
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,8">
      <TextBlock Text="STIGForge" FontSize="22" FontWeight="SemiBold" />
      <TextBlock Text="{Binding StatusText}" Margin="12,8,0,0" Foreground="Gray"/>
      <ProgressBar Width="120" Height="12" Margin="12,10,0,0" IsIndeterminate="True"
                   Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}" />
    </DockPanel>

    <TabControl Grid.Row="1">
      <TabItem Header="Content Packs">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Import ZIP..." Width="140" Command="{Binding ImportContentPackCommand}" />
            <TextBlock Text="{Binding ImportHint}" Margin="12,8,0,0" Foreground="Gray"/>
          </StackPanel>

          <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ListView Grid.Column="0" ItemsSource="{Binding ContentPacks}" SelectedItem="{Binding SelectedPack}">
              <ListView.View>
                <GridView>
                  <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="220"/>
                  <GridViewColumn Header="PackId" DisplayMemberBinding="{Binding PackId}" Width="260"/>
                  <GridViewColumn Header="ImportedAt" DisplayMemberBinding="{Binding ImportedAt}" Width="180"/>
                  <GridViewColumn Header="Source" DisplayMemberBinding="{Binding SourceLabel}" Width="220"/>
                </GridView>
              </ListView.View>
            </ListView>

            <StackPanel Grid.Column="1" Margin="12,0,0,0">
              <TextBlock Text="Pack Details" FontWeight="SemiBold" />
              <TextBlock Text="Name:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailName}" Foreground="Gray" />

              <TextBlock Text="PackId:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailId}" Foreground="Gray" />

              <TextBlock Text="Release date:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailReleaseDate}" Foreground="Gray" />

              <TextBlock Text="Imported:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailImportedAt}" Foreground="Gray" />

              <TextBlock Text="Source:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailSource}" Foreground="Gray" />

              <TextBlock Text="Hash:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailHash}" Foreground="Gray" TextWrapping="Wrap" />

              <TextBlock Text="Controls:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailControls}" Foreground="Gray" />

              <TextBlock Text="Root:" Margin="0,6,0,0" />
              <TextBlock Text="{Binding PackDetailRoot}" Foreground="Gray" TextWrapping="Wrap" />

              <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <Button Content="Open Pack" Width="120" Command="{Binding OpenPackFolderCommand}" />
                <Button Content="Export Map" Width="120" Margin="6,0,0,0" Command="{Binding ExportPowerStigMapCommand}" />
              </StackPanel>
            </StackPanel>
          </Grid>
        </Grid>
      </TabItem>

      <TabItem Header="Profiles">
        <Grid Margin="12">
          <StackPanel>
            <TextBlock Text="Profile Editor" FontWeight="SemiBold" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Profile:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,0,0" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}"
                        DisplayMemberPath="Name" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Name:" Width="80" VerticalAlignment="Center" />
              <TextBox Width="320" Text="{Binding ProfileName}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Mode:" Width="80" VerticalAlignment="Center" />
              <ComboBox Width="140" SelectedItem="{Binding ProfileMode}">
                <ComboBoxItem>AuditOnly</ComboBoxItem>
                <ComboBoxItem>Safe</ComboBoxItem>
                <ComboBoxItem>Full</ComboBoxItem>
              </ComboBox>

              <TextBlock Text="Class:" Width="80" Margin="20,0,0,0" VerticalAlignment="Center" />
              <ComboBox Width="160" SelectedItem="{Binding ProfileClassification}">
                <ComboBoxItem>Classified</ComboBoxItem>
                <ComboBoxItem>Unclassified</ComboBoxItem>
                <ComboBoxItem>Mixed</ComboBoxItem>
              </ComboBox>
            </StackPanel>

            <CheckBox Content="Auto-NA out-of-scope controls" Margin="0,8,0,0" IsChecked="{Binding ProfileAutoNa}" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Grace days:" Width="80" VerticalAlignment="Center" />
              <TextBox Width="80" Text="{Binding ProfileGraceDays}" />
            </StackPanel>

            <TextBlock Text="NA comment" Margin="0,8,0,0" />
            <TextBox Height="60" TextWrapping="Wrap" Text="{Binding ProfileNaComment}" />

            <TextBlock Text="Overlays" Margin="0,8,0,0" />
            <ItemsControl ItemsSource="{Binding OverlayItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <CheckBox Content="{Binding Overlay.Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <Button Content="Edit Overlays" Width="120" Command="{Binding OpenOverlayEditorCommand}" />
              <Button Content="Refresh" Width="90" Margin="6,0,0,0" Command="{Binding RefreshOverlaysCommand}" />
            </StackPanel>

            <Button Content="Save Profile" Width="120" Margin="0,10,0,0" Command="{Binding SaveProfileCommand}" />
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Build">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Pack:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,18,0" ItemsSource="{Binding ContentPacks}" SelectedItem="{Binding SelectedPack}"
                        DisplayMemberPath="Name" />
              <TextBlock Text="Profile:" VerticalAlignment="Center" />
              <ComboBox Width="260" Margin="6,0,0,0" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}"
                        DisplayMemberPath="Name" />
            </StackPanel>
            <Button Content="Build Bundle" Width="140" Command="{Binding BuildBundleCommand}" IsEnabled="{Binding ActionsEnabled}" />
            <TextBlock Text="Build uses release-age automation gate; see Reports/automation_gate.json in the bundle."
                       Margin="0,8,0,0" TextWrapping="Wrap" />
            <TextBlock Text="{Binding BuildGateStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <Button Content="Open Gate" Width="100" Command="{Binding OpenAutomationGateCommand}" IsEnabled="{Binding ActionsEnabled}" />
              <TextBlock Text=" {Binding AutomationGatePath}" Foreground="Gray" Margin="6,0,0,0" />
            </StackPanel>

            <TextBlock Text="Recent Bundles" Margin="0,10,0,0" />
            <StackPanel Orientation="Horizontal">
              <ComboBox Width="520" ItemsSource="{Binding RecentBundles}" SelectedItem="{Binding SelectedRecentBundle}" />
              <Button Content="Use" Width="80" Margin="6,0,0,0" Command="{Binding UseRecentBundleCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Apply">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <Button Content="Run Apply" Width="140" Command="{Binding ApplyRunCommand}" />
            <TextBlock Text="Applies using bundle Apply/RunApply.ps1" Margin="0,8,0,0" />
            <TextBlock Text="{Binding ApplyStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Verify">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Eval-STIG Root:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding EvaluateStigRoot}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseEvaluateStigCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Eval Args:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding EvaluateStigArgs}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Cmd:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding ScapCommandPath}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseScapCommandCommand}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Args:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="520" Text="{Binding ScapArgs}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="SCAP Label:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="200" Text="{Binding ScapLabel}" />
            </StackPanel>
            <StackPanel Orientation="Horizontal">
              <Button Content="Run Verify" Width="140" Command="{Binding VerifyRunCommand}" IsEnabled="{Binding ActionsEnabled}" />
              <Button Content="Ingest CKL Folder" Width="160" Margin="6,0,0,0" Command="{Binding IngestCklFolderCommand}" IsEnabled="{Binding ActionsEnabled}" />
            </StackPanel>
            <TextBlock Text="Runs Evaluate-STIG / SCAP if configured" Margin="0,8,0,0" />
            <TextBlock Text="{Binding VerifyStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <TextBlock Text="{Binding VerifySummary}" Margin="0,6,0,0" Foreground="Gray" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
            <Button Content="Refresh Overlap" Width="140" Margin="0,8,0,0" Command="{Binding RefreshOverlapCommand}" />
            <ListView ItemsSource="{Binding OverlapItems}" Height="160" Margin="0,6,0,0">
              <ListView.View>
                <GridView>
                  <GridViewColumn Header="Sources" DisplayMemberBinding="{Binding SourcesKey}" Width="220" />
                  <GridViewColumn Header="#" DisplayMemberBinding="{Binding SourceCount}" Width="40" />
                  <GridViewColumn Header="Controls" DisplayMemberBinding="{Binding ControlsCount}" Width="70" />
                  <GridViewColumn Header="Closed" DisplayMemberBinding="{Binding ClosedCount}" Width="60" />
                  <GridViewColumn Header="Open" DisplayMemberBinding="{Binding OpenCount}" Width="60" />
                </GridView>
              </ListView.View>
            </ListView>
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Evidence">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="RuleId:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="260" Text="{Binding EvidenceRuleId}" />
              <TextBlock Text="Type:" Width="60" Margin="12,0,0,0" VerticalAlignment="Center" />
              <ComboBox Width="160" ItemsSource="{Binding EvidenceTypes}" SelectedItem="{Binding EvidenceType}" />
            </StackPanel>

            <TextBlock Text="Evidence text" />
            <TextBox Height="80" TextWrapping="Wrap" Text="{Binding EvidenceText}" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="File:" Width="120" VerticalAlignment="Center" />
              <TextBox Width="420" Text="{Binding EvidenceFilePath}" />
              <Button Content="Browse" Width="80" Margin="6,0,0,0" Command="{Binding BrowseEvidenceFileCommand}" />
            </StackPanel>

            <Button Content="Save Evidence" Width="140" Margin="0,8,0,0" Command="{Binding SaveEvidenceCommand}" />
            <TextBlock Text="{Binding EvidenceStatus}" Margin="0,6,0,0" Foreground="Gray" />
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Manual">
        <Grid Margin="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
          </Grid.ColumnDefinitions>

          <ListView Grid.Column="0" ItemsSource="{Binding ManualControls}" SelectedItem="{Binding SelectedManualControl}" Height="400">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="RuleId" DisplayMemberBinding="{Binding Control.ExternalIds.RuleId}" Width="140" />
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Control.Title}" Width="220" />
                <GridViewColumn Header="Status" DisplayMemberBinding="{Binding Status}" Width="80" />
              </GridView>
            </ListView.View>
          </ListView>

          <StackPanel Grid.Column="1" Margin="12,0,0,0">
            <TextBlock Text="Selected Control" FontWeight="SemiBold" />
            <TextBlock Text="{Binding SelectedManualControl.Control.Title}" TextWrapping="Wrap" Margin="0,6,0,0" />
            <TextBlock Text="{Binding SelectedManualControl.Control.CheckText}" TextWrapping="Wrap" Margin="0,6,0,0" Foreground="Gray" />

            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
              <TextBlock Text="Status:" Width="60" VerticalAlignment="Center" />
              <ComboBox Width="160" ItemsSource="{Binding ManualStatuses}" SelectedItem="{Binding ManualStatus}" />
            </StackPanel>

            <TextBlock Text="Reason" Margin="0,8,0,0" />
            <TextBox Text="{Binding ManualReason}" Height="40" TextWrapping="Wrap" />

            <TextBlock Text="Comment" Margin="0,8,0,0" />
            <TextBox Text="{Binding ManualComment}" Height="80" TextWrapping="Wrap" />

            <Button Content="Save Answer" Width="120" Margin="0,8,0,0" Command="{Binding SaveManualAnswerCommand}" />
          </StackPanel>
        </Grid>
      </TabItem>

      <TabItem Header="Diff">
        <Grid Margin="12">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>

          <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Load Diff" Width="120" Command="{Binding LoadDiffCommand}" />
            <CheckBox Content="Show manual only" Margin="12,6,0,0" IsChecked="{Binding ShowManualOnly}" />
          </StackPanel>

          <ListView Grid.Row="1" ItemsSource="{Binding DiffItemsView}" Height="400">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="RuleId" DisplayMemberBinding="{Binding RuleId}" Width="140" />
                <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Title}" Width="340" />
                <GridViewColumn Header="Kind" DisplayMemberBinding="{Binding Kind}" Width="90" />
                <GridViewColumn Header="ManualChanged" DisplayMemberBinding="{Binding ManualChanged}" Width="120" />
              </GridView>
            </ListView.View>
          </ListView>
        </Grid>
      </TabItem>

      <TabItem Header="Reports">
        <Grid Margin="12">
          <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
              <TextBlock Text="Bundle:" VerticalAlignment="Center" />
              <TextBox Width="520" Margin="6,0,6,0" Text="{Binding BundleRoot}" />
              <Button Content="Browse" Width="80" Command="{Binding BrowseBundleCommand}" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenBundleFolderCommand}" />
            </StackPanel>
            <TextBlock Text="Recent Bundles" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <ComboBox Width="520" ItemsSource="{Binding RecentBundles}" SelectedItem="{Binding SelectedRecentBundle}" />
              <Button Content="Use" Width="80" Margin="6,0,0,0" Command="{Binding UseRecentBundleCommand}" />
            </StackPanel>
            <Button Content="Export eMASS" Width="140" Command="{Binding ExportEmassCommand}" IsEnabled="{Binding ActionsEnabled}" />
            <TextBlock Text="Exports eMASS package from bundle" Margin="0,8,0,0" />
            <TextBlock Text="{Binding ExportStatus}" Margin="0,6,0,0" Foreground="Gray" />
            <TextBlock Text="{Binding ReportSummary}" Margin="0,6,0,0" Foreground="Gray" />
            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
              <TextBlock Text="Last output:" Foreground="Gray" />
              <TextBlock Text=" {Binding LastOutputPath}" Foreground="Gray" />
              <Button Content="Open" Width="80" Margin="6,0,0,0" Command="{Binding OpenLastOutputCommand}" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
