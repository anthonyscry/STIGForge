---
phase: 13-performance-baselining
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - benchmarks/STIGForge.Benchmarks/StartupBenchmarks.cs
  - benchmarks/STIGForge.Benchmarks/STIGForge.Benchmarks.csproj
  - src/STIGForge.App/App.xaml.cs
autonomous: true
requirements: [PERF-01, PERF-02]
user_setup: []

must_haves:
  truths:
    - "Cold startup time can be measured with BenchmarkDotNet ColdStart strategy"
    - "Warm startup time can be measured via internal initialization timing"
    - "Startup measurements are reproducible and documented"
  artifacts:
    - path: "benchmarks/STIGForge.Benchmarks/StartupBenchmarks.cs"
      provides: "Cold and warm startup time benchmarks"
      exports: ["ColdStartup", "WarmStartupInternal"]
    - path: "src/STIGForge.App/App.xaml.cs"
      provides: "Startup timing capture to PerformanceInstrumenter"
  key_links:
    - from: "StartupBenchmarks"
      to: "STIGForge.App.exe"
      via: "Process.Start with --exit-after-load flag"
      pattern: "BenchmarkDotNet ColdStart"
---

<objective>
Implement startup time benchmarks for WPF application using BenchmarkDotNet, measuring both cold startup (new process per iteration) and warm startup (internal initialization timing).

Purpose: Establish reproducible baselines for PERF-01 (< 3s cold) and PERF-02 (< 1s warm) targets.
Output: Working StartupBenchmarks that produce reliable cold and warm startup measurements.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-performance-baselining/13-RESEARCH.md
@.planning/phases/13-performance-baselining/13-01-SUMMARY.md

# Benchmark infrastructure from 13-01
@benchmarks/STIGForge.Benchmarks/BenchmarkConfig.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add startup timing to App.xaml.cs</name>
  <files>src/STIGForge.App/App.xaml.cs</files>
  <action>
Add startup timing measurement to App.xaml.cs that captures time from OnStartup to MainWindow.Loaded event.

Implementation:
1. In OnStartup, capture stopwatch start timestamp before any initialization
2. In MainWindow_Loaded event handler (attach if not exists), stop stopwatch and calculate elapsed
3. Call PerformanceInstrumenter.RecordStartupTime(elapsedMs, isColdStart: true) on first launch
4. Add environment variable or command-line flag support for --exit-after-load to support benchmark automation

The timing should measure:
- Start: Beginning of OnStartup method
- End: MainWindow.Loaded event firing

Do NOT block startup for timing - timing should be non-intrusive. Use Stopwatch for high-resolution timing.
  </action>
  <verify>
    <command>dotnet build src/STIGForge.App/STIGForge.App.csproj</command>
    <expect>Build succeeds with no errors</expect>
  </verify>
  <done>App.xaml.cs captures startup timing and records to PerformanceInstrumenter, supports --exit-after-load flag</done>
</task>

<task type="auto">
  <name>Task 2: Create StartupBenchmarks</name>
  <files>
    benchmarks/STIGForge.Benchmarks/StartupBenchmarks.cs
    benchmarks/STIGForge.Benchmarks/STIGForge.Benchmarks.csproj
  </files>
  <action>
Create StartupBenchmarks.cs with cold and warm startup measurement capabilities.

1. Add project reference to STIGForge.App in benchmarks csproj (for build dependency, not direct reference)

2. Create StartupBenchmarks class with:
   - [MemoryDiagnoser] attribute
   - [SimpleJob(RuntimeMoniker.Net80, launchCount: 3, warmupCount: 1, iterationCount: 5)]
   - GlobalSetup that creates minimal test bundle path
   - ColdStartup benchmark using [ColdStart] attribute - spawns new process per iteration
   - WarmStartupInternal benchmark (placeholder - notes that real warm startup requires external orchestration)

3. ColdStartup benchmark implementation:
   - Use Process.Start to launch STIGForge.App.exe with --exit-after-load flag
   - WaitForExit and capture exit code
   - Use path to built WPF executable relative to benchmark location

4. Update Program.cs BenchmarkSwitcher to include StartupBenchmarks

NOTE: Cold start benchmarks require building STIGForge.App first. The benchmark should locate the built exe via relative path from benchmark bin directory.

IMPORTANT: Document in comments that warm startup benchmark is limited - true warm startup requires external orchestration (run same benchmark twice and compare). The internal benchmark measures initialization within already-warm process.
  </action>
  <verify>
    <command>dotnet build benchmarks/STIGForge.Benchmarks/STIGForge.Benchmarks.csproj -c Release</command>
    <expect>Build succeeds with no errors</expect>
  </verify>
  <done>StartupBenchmarks compiles with ColdStartup benchmark, BenchmarkSwitcher updated to include it</done>
</task>

</tasks>

<verification>
- StartupBenchmarks.cs exists with ColdStartup and WarmStartupInternal benchmarks
- App.xaml.cs captures and records startup timing
- --exit-after-load flag causes app to exit after MainWindow.Loaded
- BenchmarkDotNet project compiles in Release mode
- BenchmarkSwitcher includes StartupBenchmarks
</verification>

<success_criteria>
- Cold startup benchmark spawns new process per iteration
- Startup timing captured from OnStartup to MainWindow.Loaded
- Benchmarks produce reproducible measurements (statistical analysis via BenchmarkDotNet)
- Warm startup limitations documented in benchmark comments
</success_criteria>

<output>
After completion, create `.planning/phases/13-performance-baselining/13-02-SUMMARY.md`
</output>
