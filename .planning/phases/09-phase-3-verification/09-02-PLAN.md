---
wave: 1
depends_on: []
files_modified:
  - .planning/phases/03-deterministic-mission-execution-core/03-02-SUMMARY.md
  - .planning/phases/03-deterministic-mission-execution-core/03-VERIFICATION.md
autonomous: true
requirements:
  - APL-01
must_haves:
  truths:
    - Preflight.ps1 extends existing checks with PowerSTIG, DSC, and mutual-exclusion validation
    - PreflightRunner C# wrapper invokes Preflight.ps1 and parses JSON output
    - Exit code 0 = OK, 1 = issues with explicit failure reasons
  artifacts:
    - Preflight.ps1 with Test-PowerStigAvailable, Test-DscResources, Test-MutualExclusion
    - PreflightRunner class with JSON parsing and error handling
    - PreflightRequest and PreflightResult models
    - 7 passing PreflightRunnerTests
  key_links:
    - tools/apply/Preflight/Preflight.ps1 (extended checks)
    - src/STIGForge.Apply/PreflightRunner.cs (C# wrapper)
    - src/STIGForge.Apply/ApplyModels.cs (PreflightRequest/Result)
    - tests/STIGForge.UnitTests/Apply/PreflightRunnerTests.cs
---

# 09-02: Verify APL-01 - Apply Preflight Safety Checks

## Goal

Gather evidence that requirement APL-01 (apply preflight enforces elevation/compatibility/reboot/PowerShell safety checks) is satisfied by Phase 3 implementation.

## Tasks

<tasks>
<task>
<action>Read commit summary for plan 03-02 to verify implementation details</action>
<files>.planning/phases/03-deterministic-mission-execution-core/03-02-SUMMARY.md</files>
<verify>Summary confirms Preflight.ps1 extensions, PreflightRunner wrapper, models, and 7 tests</verify>
<done>03-02-SUMMARY.md read and verified</done>
</task>
<task>
<action>Verify Preflight.ps1 has extended checks</action>
<files>tools/apply/Preflight/Preflight.ps1</files>
<verify>Script has Test-PowerStigAvailable, Test-DscResources, Test-MutualExclusion functions and JSON output</verify>
<done>Preflight.ps1 extensions verified</done>
</task>
<task>
<action>Verify PreflightRunner C# wrapper implementation</action>
<files>src/STIGForge.Apply/PreflightRunner.cs</files>
<verify>PreflightRunner has RunAsync method that invokes PowerShell, captures stdout, parses JSON, handles errors</verify>
<done>PreflightRunner wrapper verified</done>
</task>
<task>
<action>Verify PreflightRequest and PreflightResult models</action>
<files>src/STIGForge.Apply/ApplyModels.cs</files>
<verify>Models have required properties: PowerStigModulePath, DscResourcePath, Controls, Issues, etc.</verify>
<done>Preflight models verified</done>
</task>
<task>
<action>Verify PreflightRunnerTests exist and cover scenarios</action>
<files>tests/STIGForge.UnitTests/Apply/PreflightRunnerTests.cs</files>
<verify>7 tests covering missing script, valid JSON, JSON with issues, exit code override, invalid JSON fallback, empty output</verify>
<done>PreflightRunnerTests verified</done>
</task>
<task>
<action>Document verification evidence in 03-VERIFICATION.md</action>
<files>.planning/phases/03-deterministic-mission-execution-core/03-VERIFICATION.md</files>
<verify>03-VERIFICATION.md includes APL-01 section with test evidence, source evidence, and commit evidence</verify>
<done>APL-01 verification evidence documented</done>
</task>
</tasks>

## Verification Criteria

- APL-01 requirement is mapped to plan 03-02
- All 3 preflight extensions (PowerSTIG, DSC, mutual-exclusion) are documented
- PreflightRunner wrapper evidence includes invocation pattern and JSON parsing
- Test evidence covers success and failure scenarios
- Commit evidence references 03-02-SUMMARY.md and commit hash cbf7516
- Status is set to SATISFIED with clear evidence

## Success Criteria

- 03-VERIFICATION.md APL-01 section is complete
- Preflight.ps1 extensions are documented with function names
- PreflightRunner wrapper is documented with error handling details
- All 7 tests are listed with their purpose
