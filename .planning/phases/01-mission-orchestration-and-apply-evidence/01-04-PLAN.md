---
phase: 01-mission-orchestration-and-apply-evidence
plan: 04
type: execute
wave: 3
depends_on:
  - 01-01
  - 01-03
files_modified:
  - src/STIGForge.Core/Services/BundleMissionSummaryService.cs
  - src/STIGForge.Cli/Commands/BundleCommands.cs
  - src/STIGForge.App/MainViewModel.cs
  - src/STIGForge.App/MainViewModel.ApplyVerify.cs
  - src/STIGForge.App/Views/GuidedRunView.xaml
  - src/STIGForge.App/Views/OrchestrateView.xaml
  - tests/STIGForge.UnitTests/Services/BundleMissionSummaryServiceTests.cs
  - tests/STIGForge.UnitTests/Cli/BundleCommandsTimelineTests.cs
autonomous: true
requirements:
  - FLOW-03
must_haves:
  truths:
    - "Operators can view mission timeline state from CLI without reading raw logs"
    - "WPF guided/orchestrate views show ordered timeline visibility for active bundle runs"
    - "Mission summary derives severity and next action from persisted timeline state"
  artifacts:
    - path: "src/STIGForge.Cli/Commands/BundleCommands.cs"
      provides: "Mission timeline CLI projection command/output"
      contains: "mission-timeline"
    - path: "src/STIGForge.App/MainViewModel.ApplyVerify.cs"
      provides: "Timeline loading and refresh integration for orchestration"
      contains: "Orchestrate"
    - path: "src/STIGForge.App/Views/GuidedRunView.xaml"
      provides: "Operator timeline UI surface in guided flow"
      contains: "Timeline"
  key_links:
    - from: "src/STIGForge.Core/Services/BundleMissionSummaryService.cs"
      to: "MissionRunRepository"
      via: "summary projection with timeline-derived state"
      pattern: "MissionRun"
    - from: "src/STIGForge.App/MainViewModel.ApplyVerify.cs"
      to: "src/STIGForge.App/Views/GuidedRunView.xaml"
      via: "timeline binding"
      pattern: "ItemsSource"
---

<objective>
Expose first-class timeline visibility in CLI and WPF so operators can inspect mission progression and outcomes deterministically.

Purpose: Complete FLOW-03 by projecting mission-run ledger data into operator-facing mission summary and timeline views.
Output: Timeline command, WPF timeline panels, and summary service projection updates.
</objective>

<execution_context>
@/home/anthonyscry/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-mission-orchestration-and-apply-evidence/01-RESEARCH.md
@.planning/phases/01-mission-orchestration-and-apply-evidence/01-01-SUMMARY.md
@.planning/phases/01-mission-orchestration-and-apply-evidence/01-03-SUMMARY.md
@src/STIGForge.Core/Services/BundleMissionSummaryService.cs
@src/STIGForge.Cli/Commands/BundleCommands.cs
@src/STIGForge.App/MainViewModel.ApplyVerify.cs
@src/STIGForge.App/Views/GuidedRunView.xaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mission timeline projection to summary and CLI surfaces</name>
  <files>src/STIGForge.Core/Services/BundleMissionSummaryService.cs, src/STIGForge.Cli/Commands/BundleCommands.cs, tests/STIGForge.UnitTests/Cli/BundleCommandsTimelineTests.cs</files>
  <action>Extend summary service to load latest mission run timeline and compute timeline-derived status fields (last phase, last event, blocking state). Add a CLI command (or extend `bundle-summary` with a timeline mode) that prints ordered timeline rows and JSON output keyed by run ID/sequence/event type; avoid parsing free-form log text.</action>
  <verify>`dotnet test tests/STIGForge.UnitTests/STIGForge.UnitTests.csproj --filter "BundleMissionSummaryServiceTests|BundleCommandsTimelineTests"`</verify>
  <done>CLI exposes deterministic timeline visibility for bundle runs, and summary projection includes timeline-derived mission status.</done>
</task>

<task type="auto">
  <name>Task 2: Wire timeline data into MainViewModel orchestration flow</name>
  <files>src/STIGForge.App/MainViewModel.cs, src/STIGForge.App/MainViewModel.ApplyVerify.cs</files>
  <action>Add timeline view-model properties/collections and refresh them after apply/verify/orchestrate execution and during bundle selection changes. Use repository-backed ordered timeline data; keep existing orchestration behavior while replacing ad hoc text-only progress interpretation with timeline-backed status where available.</action>
  <verify>`dotnet test tests/STIGForge.UnitTests/STIGForge.UnitTests.csproj --filter "BundleMissionSummaryServiceTests|SmokeTests"`</verify>
  <done>MainViewModel provides ordered timeline state and updates it consistently after mission actions.</done>
</task>

<task type="auto">
  <name>Task 3: Add timeline UI sections to Guided and Orchestrate views</name>
  <files>src/STIGForge.App/Views/GuidedRunView.xaml, src/STIGForge.App/Views/OrchestrateView.xaml, tests/STIGForge.UnitTests/Services/BundleMissionSummaryServiceTests.cs</files>
  <action>Add compact timeline panels in both views showing sequence, phase/event, status, and timestamp. Keep existing guided workflow layout intact, but ensure timeline is visible without opening raw logs. Include empty-state messaging when no mission run exists yet.</action>
  <verify>`dotnet test tests/STIGForge.UnitTests/STIGForge.UnitTests.csproj --filter "AppXamlContractTests|BundleMissionSummaryServiceTests"`</verify>
  <done>Operators can inspect mission timeline from WPF guided and orchestrate screens with deterministic ordering and clear empty-state behavior.</done>
</task>

</tasks>

<verification>
Run `dotnet test tests/STIGForge.UnitTests/STIGForge.UnitTests.csproj --filter "BundleMissionSummaryServiceTests|BundleCommandsTimelineTests|AppXamlContractTests"` and verify timeline projection and UI contract tests pass.
</verification>

<success_criteria>
Mission timeline is visible and consistent across CLI and WPF using the same persisted run/event source.
</success_criteria>

<output>
After completion, create `.planning/phases/01-mission-orchestration-and-apply-evidence/01-04-SUMMARY.md`
</output>
